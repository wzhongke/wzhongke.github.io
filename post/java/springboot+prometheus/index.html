<!DOCTYPE html>
<html lang="zh-cn">

<head>

  
  <meta charset="UTF-8">
  <title>
    Springboot2 &#43; Prometheus 监控 | World of Wang
  </title>


  
  <meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1">

  
  <link rel="canonical" href="https://wzhongke.github.io/post/java/springboot&#43;prometheus/" />

  
  
  <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
  <link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/ocean.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://wzhongke.github.io//css/index.css">
  
  <link href="https://wzhongke.github.io/index.xml" rel="alternate" type="application/rss+xml" title="World of Wang" />
  <link href="https://wzhongke.github.io/index.xml" rel="feed" type="application/rss+xml" title="World of Wang" />

  
  <link href="https://wzhongke.github.io//favicon.ico" rel="shortcut icon">

  <script>
    window.origin = "https://wzhongke.github.io/";
    
    var outer = document.createElement('div');
    outer.style.cssText = "visibility:hidden;width:100%;overflow:scroll";
    document.documentElement.appendChild(outer);
    window.scrollWidth = outer.offsetWidth - outer.clientWidth;
    document.documentElement.removeChild(outer);
  </script>
</head>

 

<body>
  
  <div id="modal-search" class="modal">
    <div class="modal-content">
      <form>
        <div class="row">
          <div class="input-field col s12">
            <input id="in-search" type="text" required aria-required="true" autofocus autocomplete="off"/>
            <label for='in-search'>Search</label>
          </div>
        </div>
      </form>
      <div class="out-wrapper row">
        <div id="out-search" class="collection col s12"></div>
      </div>
    </div>
  </div>

  <div class="navbar-fixed">
    <nav class="navbar">
      <div class="nav-wrapper container">
        <a href="javascript:void(0)" class="button-collapse"><i class="material-icons">menu</i></a>
        <a href="https://wzhongke.github.io/" class="brand-logo"><i class="material-icons">restaurant_menu</i> 
          World of Wang
        </a>

        <ul class="right hide-on-small-and-down">
          
          <li><a class="modal-trigger" href='#modal-search'><i class="material-icons">search</i></a></li>
          <li><a href='https://wzhongke.github.io/index.xml' target="_blank"><i class="material-icons">rss_feed</i></a></li>
        </ul>
        
        <ul class="center tabs tabs-transparent hide-on-med-and-down">
          
          <li class="tab">
            <a href="https://wzhongke.github.io//" class=''>
                Home
              </a>
          </li>
          
          <li class="tab">
            <a href="https://wzhongke.github.io//archive/" class=''>
                Archive
              </a>
          </li>
          
          <li class="tab">
            <a href="https://wzhongke.github.io//about/" class=''>
                About
              </a>
          </li>
          
          <li class="tab">
            <a href="https://wzhongke.github.io//post/%E7%A2%B0%E5%88%B0%E8%BF%87%E7%9A%84%E9%97%AE%E9%A2%98/" class=''>
                碰到过的问题
              </a>
          </li>
          
        </ul>
        
      </div>
    </nav>
  </div> <aside class="side-panel">
  <div class="inner">
    <div class="profile">
      <div class="profile__bg" style="background-image:url('https://wzhongke.github.io//img/profile-bg.jpg')"></div>
      <img class="profile__avatar" src="https://wzhongke.github.io//img/sign.jpg" alt="avatar" /> 
      <h3 class="profile__name">壹冶知秋</h3> 
      <p class="profile__desc">Do not ride on fear...</p>
    </div>
    <ul class="nav-group show-on-medium-and-down menu ">
       
      <li>
        <a class="collapsible-header waves-effect waves-indigo" href="https://wzhongke.github.io//">
          <i class='material-icons'>home</i>
          <span class="content">Home</span>
          <i class="material-icons">chevron_right</i>
        </a>
      </li>
      
      <li>
        <a class="collapsible-header waves-effect waves-indigo" href="https://wzhongke.github.io//archive/">
          <i class='material-icons'>archive</i>
          <span class="content">Archive</span>
          <i class="material-icons">chevron_right</i>
        </a>
      </li>
      
      <li>
        <a class="collapsible-header waves-effect waves-indigo" href="https://wzhongke.github.io//about/">
          <i class='material-icons'>person</i>
          <span class="content">About</span>
          <i class="material-icons">chevron_right</i>
        </a>
      </li>
      
      <li>
        <a class="collapsible-header waves-effect waves-indigo" href="https://wzhongke.github.io//post/%E7%A2%B0%E5%88%B0%E8%BF%87%E7%9A%84%E9%97%AE%E9%A2%98/">
          <i class='material-icons'>bookmark</i>
          <span class="content">碰到过的问题</span>
          <i class="material-icons">chevron_right</i>
        </a>
      </li>
       
    </ul>
    <ul class="nav-group show-on-small tools">
      <li>
        <a class="collapsible-header waves-effect waves-indigo modal-trigger" href='#modal-search'>
            <i class="material-icons">search</i>
            <span class="content">Search</span>
            <i class="material-icons">chevron_right</i>
          </a>
      </li>
      <li>
        <a class="collapsible-header waves-effect waves-indigo" target="_blank" href='https://wzhongke.github.io/index.xml'>
            <i class="material-icons">rss_feed</i>
            <span class="content">RSS Feed</span>
            <i class="material-icons">chevron_right</i>
          </a>
      </li>
    </ul>
    <ul class="collapsible nav-group" data-collapsible="accordion">
      <li>
        <div class="collapsible-header waves-effect waves-indigo">
          <i class="material-icons">whatshot</i>
          <span class="content">Latest</span>
          <i class="material-icons angle">expand_more</i>
        </div>
        <div class="collapsible-body">
          <div class="collection">
            
            <a class="collection-item" href="https://wzhongke.github.io/post/front/javascript/">javascript 基础</a> 
            
            <a class="collection-item" href="https://wzhongke.github.io/post/java/netty/">高并发 netty</a> 
            
            <a class="collection-item" href="https://wzhongke.github.io/post/front/flex%E5%B8%83%E5%B1%80/">flex 布局</a> 
            
            <a class="collection-item" href="https://wzhongke.github.io/post/front/es6/">es6</a> 
            
            <a class="collection-item" href="https://wzhongke.github.io/post/front/%E4%BD%A0%E4%B8%8D%E7%9F%A5%E9%81%93%E7%9A%84javascript/">你不知道的JavaScript读书笔记</a> 
            
            <a class="collection-item" href="https://wzhongke.github.io/post/front/webpack/">webpack</a> 
            
            <a class="collection-item" href="https://wzhongke.github.io/post/algorithms/%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%8C%B9%E9%85%8D%E7%AE%97%E6%B3%95/">字符串匹配算法</a> 
            
            <a class="collection-item" href="https://wzhongke.github.io/post/front/css-%E6%80%BB%E7%BB%93/">css使用方式总结</a> 
            
            <a class="collection-item" href="https://wzhongke.github.io/post/java/springlearn/">spring 学习笔记</a> 
            
            <a class="collection-item" href="https://wzhongke.github.io/post/algorithms/%E6%A0%91/">树算法</a> 
            
          </div>
        </div>
      </li>
      
      <li>
        <div class="collapsible-header waves-effect waves-indigo">
          <i class="material-icons"><i class='material-icons'>class</i></i>
          <span class="content">Category </span>
          
          <i class="material-icons angle">expand_more</i>
        </div>
        <div class="collapsible-body">
          <div class="collection">
            
            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/java"> java<span class="badge">11</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/linux"> linux<span class="badge">9</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/javascript"> javascript<span class="badge">7</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/%E7%AE%97%E6%B3%95"> 算法<span class="badge">7</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/python"> python<span class="badge">5</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"> 设计模式<span class="badge">5</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/other"> other<span class="badge">4</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/%E5%B7%A5%E5%85%B7"> 工具<span class="badge">3</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/css"> css<span class="badge">2</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/mysql"> mysql<span class="badge">2</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/error"> error<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/markdown"> markdown<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/nodejs"> nodejs<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/sql"> sql<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/svg"> svg<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/vue"> vue<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/%E6%97%85%E8%A1%8C"> 旅行<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//categories/%E7%BC%96%E7%A8%8B"> 编程<span class="badge">1</span></a>            
            
          </div>
        </div>
      </li>
      
      <li>
        <div class="collapsible-header waves-effect waves-indigo">
          <i class="material-icons"><i class='material-icons'>local_offer</i></i>
          <span class="content">Tag </span>
          
          <i class="material-icons angle">expand_more</i>
        </div>
        <div class="collapsible-body">
          <div class="collection">
            
            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/java"> java<span class="badge">11</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/linux"> linux<span class="badge">9</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/javascript"> javascript<span class="badge">6</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/%E7%AE%97%E6%B3%95"> 算法<span class="badge">6</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/python"> python<span class="badge">5</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"> 设计模式<span class="badge">5</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/other"> other<span class="badge">4</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/%E5%B7%A5%E5%85%B7"> 工具<span class="badge">3</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/css"> css<span class="badge">2</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/markdown"> markdown<span class="badge">2</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/mysql"> mysql<span class="badge">2</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/error"> error<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/nodejs"> nodejs<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/sql"> sql<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/svg"> svg<span class="badge">1</span></a>            
            
            <a class="collection-item" href="https://wzhongke.github.io//tags/%E6%97%85%E8%A1%8C"> 旅行<span class="badge">1</span></a>            
            
          </div>
        </div>
      </li>
      
    </ul>
    <ul class="nav-group external-link">
       
      <li>
        <a class="collapsible-header waves-effect waves-indigo" href="https://github.com/wzhongke" target="_blank">
          <svg class='svg-icons svg-icons-github'><use xlink:href='#svg-icons-github'></use></svg>
          <span class="content">Github<small>@wzhongke</small></span>
          <i class="material-icons">chevron_right</i>
        </a>
      </li>
       
    </ul>
  </div>
</aside>

<main id="single" role="main" class="main-panel ">
  <section class="container">
    <div class="inner">
       <div class="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation">
   
   
   
  
    <a class="breadcrumb" href="https://wzhongke.github.io/"><i class="material-icons">location_on</i>Home</a>
    
       
      
      
      
       
        
          <a class="breadcrumb" href='https://wzhongke.github.io/post/'>Post</a>
         
       
    
       
      
      
      
       
        
          <a class="breadcrumb" href='https://wzhongke.github.io/post/java/'>Java</a>
         
       
    
       
      
      
      
       
        
          <span class="breadcrumb">Springboot2 &#43; Prometheus 监控</span>
         
       
    
       
      
      
      
       
     
</div>
       <section class="post-wrapper">
      <div class="toc-panel">
        <nav id="TableOfContents">
<ul>
<li><a href="#配置springboot">配置SpringBoot</a></li>
<li><a href="#配置-prometheus">配置 Prometheus</a></li>
</ul>
</nav>
      </div>
      <div class="post">
        <div class="card">
          <div class="card-content">
            <span class="card-title">Springboot2 &#43; Prometheus 监控 </span>
            <span class="card-meta">
              <time>
                
                <span>Mon Jan 1 0001</span>
            </time>
            
            </span>

            <article class="article">
              

<p>从 <strong>SpringBoot 2.0</strong> 开始，<a href="https://micrometer.io/">Micrometer</a> 就成为默认的指标输出引擎。 Micrometer 是一种支持多种检测系统的应用，像 Atlas，Datadog, Prometheus 等等。</p>

<h1 id="配置springboot">配置SpringBoot</h1>

<p>只需要在依赖中加入 SpringBoot Actuator 和 micrometer，Spring Boot 就会自动装配一个 MeterRegistry，并且把在 classpath 中找到的支持的实现都注册到 MeterRegistry 中。</p>

<p>在 <code>pom.xml</code> 中加入如下依赖：</p>

<pre><code class="language-xml">&lt;!-- Spring boot actuator to expose metrics endpoint --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;
    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;
&lt;/dependency&gt;
&lt;!-- https://mvnrepository.com/artifact/io.micrometer/micrometer-core --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-core&lt;/artifactId&gt;
    &lt;version&gt;1.0.4&lt;/version&gt;
&lt;/dependency&gt;
 &lt;!-- https://mvnrepository.com/artifact/io.micrometer/micrometer-registry-prometheus --&gt;
&lt;dependency&gt;
    &lt;groupId&gt;io.micrometer&lt;/groupId&gt;
    &lt;artifactId&gt;micrometer-registry-prometheus&lt;/artifactId&gt;
    &lt;version&gt;1.0.4&lt;/version&gt;
&lt;/dependency&gt;
</code></pre>

<p>然后在 <code>application.properties</code> 配置文件中加入如下配置：</p>

<pre><code># Metrics related configurations
management.endpoint.metrics.enabled=true
management.endpoints.web.exposure.include=*
management.endpoint.prometheus.enabled=true
management.metrics.export.prometheus.enabled=true
</code></pre>

<p>启动应用程序后，使用浏览器访问 <a href="http://localhost:8080/actuator，可以看到如下的端点：">http://localhost:8080/actuator，可以看到如下的端点：</a></p>

<pre><code class="language-json">{
    ...,
    &quot;prometheus&quot;: {
        &quot;href&quot;: &quot;http://localhost:8080/actuator/prometheus&quot;,
        &quot;templated&quot;: false
    },
    ...
}
</code></pre>

<p>在浏览器中访问 <a href="http://localhost:8080/actuator/prometheus，可以看到应用程序的一些指标。">http://localhost:8080/actuator/prometheus，可以看到应用程序的一些指标。</a></p>

<pre><code># HELP system_cpu_usage The &quot;recent cpu usage&quot; for the whole system
# TYPE system_cpu_usage gauge
system_cpu_usage{application=&quot;MYAPPNAME&quot;,} 0.08734939759036145
# HELP jvm_memory_used_bytes The amount of used memory
# TYPE jvm_memory_used_bytes gauge
jvm_memory_used_bytes{application=&quot;MYAPPNAME&quot;,area=&quot;nonheap&quot;,id=&quot;Code Cache&quot;,} 2.4843776E7
jvm_memory_used_bytes{application=&quot;MYAPPNAME&quot;,area=&quot;nonheap&quot;,id=&quot;Metaspace&quot;,} 5.107712E7
jvm_memory_used_bytes{application=&quot;MYAPPNAME&quot;,area=&quot;nonheap&quot;,id=&quot;Compressed Class Space&quot;,} 6436928.0
jvm_memory_used_bytes{application=&quot;MYAPPNAME&quot;,area=&quot;heap&quot;,id=&quot;Par Eden Space&quot;,} 2.32902576E8
jvm_memory_used_bytes{application=&quot;MYAPPNAME&quot;,area=&quot;heap&quot;,id=&quot;Par Survivor Space&quot;,} 2.3072776E7
jvm_memory_used_bytes{application=&quot;MYAPPNAME&quot;,area=&quot;heap&quot;,id=&quot;CMS Old Gen&quot;,} 4.85477784E8
# HELP tomcat_servlet_request_max_seconds  
# TYPE tomcat_servlet_request_max_seconds gauge
...
</code></pre>

<h1 id="配置-prometheus">配置 Prometheus</h1>

<p>在 <code>/tmp</code> 目录下新建文件 <code>prometheus.yml</code>，并写入如下配置：</p>

<pre><code class="language-yml">#Global configurations
global:
    scrape_interval:     5s # Set the scrape interval to every 5 seconds.
    evaluation_interval: 5s # Evaluate rules every 5 seconds.
scrape_configs:
    - job_name: 'person-app'
        metrics_path: '/actuator/prometheus'
        static_configs:
        - targets: ['localhost:8080'] # 写入机器端口
</code></pre>

<p>然后通过 docker 执行：<code>docker run -p 9090:9090 -v /tmp/prometheus.yml:/etc/prometheus/prometheus.yml prom/prometheus</code>，就可以启动 prometheus。</p>

<p>通过浏览器访问 <a href="http://localhost:9090">http://localhost:9090</a> 就可以看到监控。</p>

            </article>

          </div>
          
          <div class="card-action">
            
 <div class="comments"><div id="disqus_thread"></div></div>

<script type="text/javascript">
     
    var disqus_shortname = 'wzhongke';

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>



          </div>
        </div>
        
          <div class="pagination-single">
             
            <span class="pagination-item previous">
            <i class="material-icons">navigate_before</i>
            <a href="https://wzhongke.github.io/post/linux/docker/" rel="prev">docker</a>
          </span>  
          
            <span class="pagination-item next">
            <i class="material-icons">navigate_next</i>
            <a href="https://wzhongke.github.io/post/front/html%E6%A0%87%E7%AD%BE/" rel="next">HTML 标签</a> 
          </span> 
          </div>
        
      </div>
    </section>
    </div>
  </section>
  
<footer class="page-footer">
  <div class="container">
    <div class="row">
      <div class="col l6 s12">
        <h5 class="white-text">World of Wang</h5>
        <p class="grey-text text-lighten-4">Theme <a href="https://github.com/stkevintan/hugo-YAMT-theme" target="_blank">YAMT</a> designed by <a href="https://github.com/stkevintan" target="_blank">Kevin Tan</a> with ❤</p>
      </div>
      <div class="col l4 offset-l2 s12">
        <h5 class="white-text">My Friends</h5>
        <ul>
          
          <li><a class="grey-text text-lighten-3" href="https://frantic1048.logdown.com/" target="_blank">Frantic1048</a></li>
          
        </ul>
      </div>
    </div>
  </div>
  <div class="footer-copyright">
    <div class="container">Copyright@Kevin Tan</div>
  </div>
</footer>

</main>

 
<script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
<script>
    hljs.initHighlightingOnLoad();
</script>
<script type="text/javascript" src="//dlweb.sogoucdn.com/common/lib/jquery/jquery-1.11.0.min.js"></script>
<script type="text/javascript" src="//cdn.bootcss.com/lunr.js/2.1.2/lunr.min.js"></script>
<script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']]
      }
    });
</script>
<script type="text/javascript" src="https://wzhongke.github.io//js/materialize.min.js"></script>
<script type="text/javascript" src="https://wzhongke.github.io//js/index.js"></script>

<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<script>
    (adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-9350854994277981",
        enable_page_level_ads: true
    });
</script>
</body>

</html>