<!DOCTYPE html><html lang="zh-cn"><head><meta charset="UTF-8"><title>spring | World of Wang</title><meta name="viewport" content="width=device-width,user-scalable=no,maximum-scale=1,initial-scale=1"><link rel="canonical" href="https://wzhongke.github.io/post/java/spring/"><link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"><link href="//cdn.bootcss.com/highlight.js/9.12.0/styles/ocean.min.css" rel="stylesheet"><link rel="stylesheet" href="https://wzhongke.github.io//css/index-ae15952095.css"><link href="https://wzhongke.github.io/index.xml" rel="alternate" type="application/rss+xml" title="World of Wang"><link href="https://wzhongke.github.io/index.xml" rel="feed" type="application/rss+xml" title="World of Wang"><link href="https://wzhongke.github.io//favicon.ico" rel="shortcut icon"><script>window.origin = "https://wzhongke.github.io/";
    
    var outer = document.createElement('div');
    outer.style.cssText = "visibility:hidden;width:100%;overflow:scroll";
    document.documentElement.appendChild(outer);
    window.scrollWidth = outer.offsetWidth - outer.clientWidth;
    document.documentElement.removeChild(outer);</script></head><body><div id="modal-search" class="modal"><div class="modal-content"><form><div class="row"><div class="input-field col s12"><input id="in-search" type="text" required aria-required="true" autofocus autocomplete="off"> <label for="in-search">Search</label></div></div></form><div class="out-wrapper row"><div id="out-search" class="collection col s12"></div></div></div></div><div class="navbar-fixed"><nav class="navbar"><div class="nav-wrapper container"><a href="javascript:void(0)" class="button-collapse"><i class="material-icons">menu</i></a> <a href="https://wzhongke.github.io/" class="brand-logo"><i class="material-icons">restaurant_menu</i> World of Wang</a><ul class="right hide-on-small-and-down"><li><a class="modal-trigger" href="#modal-search"><i class="material-icons">search</i></a></li><li><a href="https://wzhongke.github.io/index.xml" target="_blank"><i class="material-icons">rss_feed</i></a></li></ul><ul class="center tabs tabs-transparent hide-on-med-and-down"><li class="tab"><a href="https://wzhongke.github.io//" class="">Home</a></li><li class="tab"><a href="https://wzhongke.github.io//archive/" class="">Archive</a></li><li class="tab"><a href="https://wzhongke.github.io//about/" class="">About</a></li><li class="tab"><a href="https://wzhongke.github.io//post/%E7%A2%B0%E5%88%B0%E8%BF%87%E7%9A%84%E9%97%AE%E9%A2%98/" class="">碰到过的问题</a></li></ul></div></nav></div><aside class="side-panel"><div class="inner"><div class="profile"><div class="profile__bg" style="background-image:url('https://wzhongke.github.io//img/profile-bg-7c6e6a1672.jpg')"></div><img class="profile__avatar" src="https://wzhongke.github.io//img/sign-d1f802b4e8.jpg" alt="avatar"><h3 class="profile__name">壹冶知秋</h3><p class="profile__desc">Do not ride on fear...</p></div><ul class="nav-group show-on-medium-and-down menu"><li><a class="collapsible-header waves-effect waves-indigo" href="https://wzhongke.github.io//"><i class="material-icons">home</i> <span class="content">Home</span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo" href="https://wzhongke.github.io//archive/"><i class="material-icons">archive</i> <span class="content">Archive</span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo" href="https://wzhongke.github.io//about/"><i class="material-icons">person</i> <span class="content">About</span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo" href="https://wzhongke.github.io//post/%E7%A2%B0%E5%88%B0%E8%BF%87%E7%9A%84%E9%97%AE%E9%A2%98/"><i class="material-icons">bookmark</i> <span class="content">碰到过的问题</span> <i class="material-icons">chevron_right</i></a></li></ul><ul class="nav-group show-on-small tools"><li><a class="collapsible-header waves-effect waves-indigo modal-trigger" href="#modal-search"><i class="material-icons">search</i> <span class="content">Search</span> <i class="material-icons">chevron_right</i></a></li><li><a class="collapsible-header waves-effect waves-indigo" target="_blank" href="https://wzhongke.github.io/index.xml"><i class="material-icons">rss_feed</i> <span class="content">RSS Feed</span> <i class="material-icons">chevron_right</i></a></li></ul><ul class="collapsible nav-group" data-collapsible="accordion"><li><div class="collapsible-header waves-effect waves-indigo"><i class="material-icons">whatshot</i> <span class="content">Latest</span> <i class="material-icons angle">expand_more</i></div><div class="collapsible-body"><div class="collection"><a class="collection-item" href="https://wzhongke.github.io/post/">Posts</a> <a class="collection-item" href="https://wzhongke.github.io/post/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E9%9D%9E%E6%9A%B4%E5%8A%9B%E6%B2%9F%E9%80%9A/">非暴力沟通</a> <a class="collection-item" href="https://wzhongke.github.io/post/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0/%E4%BA%BA%E7%94%9F%E7%9A%84%E6%99%BA%E6%85%A7-%E5%8F%94%E6%9C%AC%E5%8D%8E/">人生的智慧_叔本华</a> <a class="collection-item" href="https://wzhongke.github.io/post/node/node%E4%BD%BF%E7%94%A8%E7%AC%94%E8%AE%B0/">node使用笔记</a> <a class="collection-item" href="https://wzhongke.github.io/post/node/typeorm/">typeorm</a> <a class="collection-item" href="https://wzhongke.github.io/post/java/spring-%E6%BA%90%E7%A0%81/">深入浅出 nodejs</a> <a class="collection-item" href="https://wzhongke.github.io/post/java/java%E5%A0%86%E5%86%85%E5%AD%98/">java 内存以及GC</a> <a class="collection-item" href="https://wzhongke.github.io/post/java/java%E8%AE%A1%E7%AE%97%E5%86%85%E5%AD%98/">java 使用代码计算内存</a> <a class="collection-item" href="https://wzhongke.github.io/post/node/%E6%B7%B1%E5%85%A5%E6%B5%85%E5%87%BAnode/">深入浅出 nodejs</a> <a class="collection-item" href="https://wzhongke.github.io/post/front/javascript/">javascript 基础</a></div></div></li><li><div class="collapsible-header waves-effect waves-indigo"><i class="material-icons"><i class="material-icons">class</i></i> <span class="content">Category </span><i class="material-icons angle">expand_more</i></div><div class="collapsible-body"><div class="collection"><a class="collection-item" href="https://wzhongke.github.io//categories/java">java<span class="badge">13</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/linux">linux<span class="badge">9</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/javascript">javascript<span class="badge">7</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/%E7%AE%97%E6%B3%95">算法<span class="badge">7</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/python">python<span class="badge">5</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">设计模式<span class="badge">5</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/mysql">mysql<span class="badge">4</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/other">other<span class="badge">4</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/%E5%B7%A5%E5%85%B7">工具<span class="badge">3</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/css">css<span class="badge">2</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">读书笔记<span class="badge">2</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/error">error<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/markdown">markdown<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/nodejs">nodejs<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/sql">sql<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/svg">svg<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/vue">vue<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/%E6%97%85%E8%A1%8C">旅行<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/%E7%A4%BE%E7%A7%91">社科<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//categories/%E7%BC%96%E7%A8%8B">编程<span class="badge">1</span></a></div></div></li><li><div class="collapsible-header waves-effect waves-indigo"><i class="material-icons"><i class="material-icons">local_offer</i></i> <span class="content">Tag </span><i class="material-icons angle">expand_more</i></div><div class="collapsible-body"><div class="collection"><a class="collection-item" href="https://wzhongke.github.io//tags/java">java<span class="badge">13</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/linux">linux<span class="badge">9</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/javascript">javascript<span class="badge">6</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/%E7%AE%97%E6%B3%95">算法<span class="badge">6</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/python">python<span class="badge">5</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F">设计模式<span class="badge">5</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/mysql">mysql<span class="badge">4</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/other">other<span class="badge">4</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/%E5%B7%A5%E5%85%B7">工具<span class="badge">3</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/css">css<span class="badge">2</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/markdown">markdown<span class="badge">2</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/error">error<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/nodejs">nodejs<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/sql">sql<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/svg">svg<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/%E6%97%85%E8%A1%8C">旅行<span class="badge">1</span></a> <a class="collection-item" href="https://wzhongke.github.io//tags/%E8%AF%BB%E4%B9%A6%E7%AC%94%E8%AE%B0">读书笔记<span class="badge">1</span></a></div></div></li></ul><ul class="nav-group external-link"><li><a class="collapsible-header waves-effect waves-indigo" href="https://github.com/wzhongke" target="_blank"><svg class="svg-icons svg-icons-github"><use xlink:href="#svg-icons-github"></use></svg> <span class="content">Github<small>@wzhongke</small></span> <i class="material-icons">chevron_right</i></a></li></ul></div></aside><main id="single" role="main" class="main-panel"><section class="container"><div class="inner"><div class="breadcrumbs" role="navigation" aria-label="breadcrumbs navigation"><a class="breadcrumb" href="https://wzhongke.github.io/"><i class="material-icons">location_on</i>Home</a> <a class="breadcrumb" href="https://wzhongke.github.io/post/">Post</a> <a class="breadcrumb" href="https://wzhongke.github.io/post/java/">Java</a> <span class="breadcrumb">spring</span></div><section class="post-wrapper"><div class="toc-panel"><nav id="TableOfContents"><ul><li><a href="#core-container">Core Container</a></li><li><a href="#aop-和-代理">AOP 和 代理</a></li><li><a href="#messaging">Messaging</a></li><li><a href="#data-accessintegration">Data Access/Integration</a></li><li><a href="#web">Web</a></li><li><a href="#test">Test</a></li><li><a href="#maven-dependency">Maven Dependency</a></li><li><a href="#日志依赖">日志依赖</a></li></ul><ul><li><a href="#container-overview">Container Overview</a></li><li><a href="#配置">配置</a><ul><li><a href="#bean-定义">Bean 定义</a></li><li><a href="#bean-命名">Bean 命名</a></li><li><a href="#bean-初始化">Bean 初始化</a></li></ul></li><li><a href="#依赖">依赖</a><ul><li><a href="#基于构造方式">基于构造方式</a></li><li><a href="#基于-setter-来构造bean">基于 Setter 来构造bean</a></li></ul></li></ul></nav></div><div class="post"><div class="card"><div class="card-content"><span class="card-title">spring </span><span class="card-meta"><time><span>Mon Jan 1 0001</span></time></span><article class="article"><h1 id="spring-模块">spring 模块</h1><h2 id="core-container">Core Container</h2><p>Core Container由 spring-core, spring-beans, spring-context, spring-context-support 和 spring-expression (Spring Expression Language)模块组成。 spring-core 和 spring-beans 模块提供了框架的基本功能——包括IoC和依赖注入。 <code>BeanFactory</code> 是一个精心设计的工厂模式，它消除了对程序单例的需求，并允许将实际程序逻辑中将依赖关系的配置和规范相分离。 spring-context 模块是在 core 和 beans 模块的基础上构建的：这是一种以类似JNDI注册表的框架访问对象方法的风格。Context模块继承了Beans模块的特性，并且增加了对国际化、事件传播、资源加载和透明创建上下文的支持。Context模块也支持Java EE的特性，如EJB，JMX和基本的远程调用。 <code>ApplicationContext</code> 接口是Context模块的核心。 spring-context-support 支持将第三方库整合到spring应用的上下文环境中，例如caching(EhCache, Guava, Jcache), mailing(JavaMail), scheduling(CommonJ, Quartz) 和模板引擎(FreeMarker, JasperReports, Velocity). spring-expression 模块为运行时查询和操作对象图提供了强大的EL表达式。</p><h2 id="aop-和-代理">AOP 和 代理</h2><p>spring-aop 模块提供了允许自定义的面向切面编程的AOP方式，比如用方法拦截和切入点来干净地将该分离的功能代码分离开。 spring-aspects 模块提供与 AspectJ 集成 spring-instrument 模块提供了在特定应用服务器中使用的类代理支持和类加载器的实现 spring-instrument-tomcat 模块包含了Tomcat的Spring工具代理</p><h2 id="messaging">Messaging</h2><p>spring-messaging 模块提供了集成Spring消息模块的整合，像Message， MessageChannel，MessageHandler 和其他作为基于消息传递的应用程序</p><h2 id="data-accessintegration">Data Access/Integration</h2><p>数据访问/集成 有 JDBC，ORM，OXM，JMS和事务模块</p><ul><li>spring-jdbc 模块提供了一个JDBC的抽象层，不需要进行单调乏味的JDBC编码和解析数据库特定的错误代码。</li><li>spring-tx 模块支持编程和声明式事务管理，用于实现特殊接口的类和所有POJO</li><li>spring-orm 模块提供了整个流行ORM API的数据层框架，如JPA，JDO和Hibernate。</li><li>spring-oxm 模块提供了支持 Object-XML映射的抽象层，像 JAXB，Castor，XML Beans，JiBX 和 XStream</li><li>spring-jms 模块包含了生产消费消息的特性</li></ul><h2 id="web">Web</h2><p>Web层包含了 spring-web, spring-webmvc, spring-websocket 和 spring-webmvc-portlet 模块</p><ul><li>spring-web 模块提供了基本的面向Web的集成功能，例如多文件上传功能，使用Servlet监听器对IoC进行初始化，面向Web的应用程序上下文。它还包含一个HTTP客户端和对Spring远程处理的Web相关部分支持。</li><li>spring-webmvc 模块包含了针对web应用程序的 Spring的 MVC 和 REST Web Services 实现。Spring的MVC框架提供了域模型代码和Web表单之间的清晰分离，并且与Spring框架的其他所有功能集成在一起。</li><li>spring-webmvc-portlet 模块（也称为Web-Portlet模块）提供了在Portlet环境中使用的MVC实现，并映射了spring-webmvc的功能</li></ul><h2 id="test">Test</h2><p>spring-test 模块支持 unit testing 和 Spring组件同 Junit或者TestNG之间的整合测试。它提供了一致的Spring <code>ApplicationContext</code>s加载和缓存上下文。 它还提供了模拟对象，您可以使用它来单独测试您的代码。</p><h2 id="maven-dependency">Maven Dependency</h2><p>使用Maven管理依赖时，我们都不需要明确地引入日志依赖。例如，创建应用上下文并使用依赖注入来配置应用，我们的Maven依赖应该如下：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;denpendencies&gt;</span>
    <span style="color:#f92672">&lt;dependency&gt;</span>
        <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework<span style="color:#f92672">&lt;/groupId&gt;</span>
        <span style="color:#f92672">&lt;artifactId&gt;</span>spring-context<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;version&gt;</span>4.3.2.RELEASE<span style="color:#f92672">&lt;/version&gt;</span>
        <span style="color:#f92672">&lt;scope&gt;</span>runtime<span style="color:#f92672">&lt;/scope&gt;</span>
    <span style="color:#f92672">&lt;/dependency&gt;</span>
<span style="color:#f92672">&lt;/dependencies&gt;</span>
</code></pre></div><p>使用Maven过程中，很可能会意外地引入不同版本的Spring jar包。比如，在第三方库或者Spring项目中，将传递的依赖关系拉到较旧的版本。如果我们没有明确指定依赖，各种各样的意外问题都可能会出现。 我们可以使用 BOM(bill of materials) 来解决这个问题，我们可以在 <code>dependencyManagement</code> 中引入 <code>spring-framework-bom</code> 来保证Spring依赖是同一个版本。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependencyManagement&gt;</span>
    <span style="color:#f92672">&lt;dependencies&gt;</span>
        <span style="color:#f92672">&lt;dependency&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>spring-framework-bom<span style="color:#f92672">&lt;/artifactId&gt;</span>
            <span style="color:#f92672">&lt;version&gt;</span>4.3.2.RELEASE<span style="color:#f92672">&lt;/version&gt;</span>
            <span style="color:#f92672">&lt;type&gt;</span>pom<span style="color:#f92672">&lt;/type&gt;</span>
            <span style="color:#f92672">&lt;scope&gt;</span>import<span style="color:#f92672">&lt;/scope&gt;</span>
        <span style="color:#f92672">&lt;/dependency&gt;</span>
    <span style="color:#f92672">&lt;/dependencies&gt;</span>
<span style="color:#f92672">&lt;/dependencyManagement&gt;</span>
</code></pre></div><p>使用BOM的另一个优点就是，我们无需在依赖中指定 <code>&lt;version&gt;</code> 属性:</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-context<span style="color:#f92672">&lt;/artifactId&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><h2 id="日志依赖">日志依赖</h2><p>Spring引入的唯一一个外部依赖是 commons-logging 包，commons-logging 的运行时发现算法是有问题的。我们可以通过两种方式将 commons-logging 换掉：</p><ol><li>在 spring-core 模块中排除依赖关系<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>org.springframework<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>spring-core<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>4.3.2.RELEASE<span style="color:#f92672">&lt;/version&gt;</span>
    <span style="color:#f92672">&lt;exclusions&gt;</span>
        <span style="color:#f92672">&lt;exclusion&gt;</span>
            <span style="color:#f92672">&lt;groupId&gt;</span>commons-logging<span style="color:#f92672">&lt;/groupId&gt;</span>
            <span style="color:#f92672">&lt;artifactId&gt;</span>commons-logging<span style="color:#f92672">&lt;/artifactId&gt;</span>
        <span style="color:#f92672">&lt;/exclusion&gt;</span>
    <span style="color:#f92672">&lt;/exclusions&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div></li><li>依靠一个特殊的 commons-logging 依赖，然后用一个空的jar来替换这个库</li></ol><p>使用Log4j来作为框架的日志系统。Log4j是稳健效率高的，我们在测试Spring的时候，用的就是Log4j。在Spring中使用Log4j，我们需要在Maven中添加依赖，并且在classpath根目录下加入其配置文件log4j.properties 或者 log4j.xml:</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;dependency&gt;</span>
    <span style="color:#f92672">&lt;groupId&gt;</span>log4j<span style="color:#f92672">&lt;/groupId&gt;</span>
    <span style="color:#f92672">&lt;artifactId&gt;</span>log4j<span style="color:#f92672">&lt;/artifactId&gt;</span>
    <span style="color:#f92672">&lt;version&gt;</span>1.2.14<span style="color:#f92672">&lt;/version&gt;</span>
<span style="color:#f92672">&lt;/dependency&gt;</span>
</code></pre></div><p>log4j.properties 如下：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml">log4j.rootCategory=INFO, stdout
log4j.appender.stdout=org.apache.log4j.ConsoleAppender
log4j.appender.stdout.layout=org.apache.log4j.PatternLayout
log4j.appender.stdout.layout.ConversionPattern=%d{ABSOLUTE} %5p %t %c{2}:%L - %m%n
log4j.category.org.springframework.beans.factory=DEBUG
</code></pre></div><h1 id="the-ioc-container">The IoC container</h1><p>控制反转（IoC，又名依赖注入 DI）是一个过程，对象通过构造参数，或者工厂方法的参数，或者设置构造完成对象的参数来定义他们的依赖关系。然后容器在创建bean时将其依赖的对象注入到bean中。 <code>org.springframework.beans</code> 和 <code>org.springframework.context</code> 是Spring框架IoC容器的核心包。<code>BeanFactory</code> 接口提供了配置框架和基本的功能，<code>ApplicationContext</code> 增加了更多企业特定的功能，它完全是<code>BeanFactory</code>的超集。 那些构成应用程序骨干并被Spring IoC容器管理的对象，被称为 beans。</p><h2 id="container-overview">Container Overview</h2><p><code>org.springframework.context.ApplicationContext</code> 接口代表了Spring IoC容器，它负责初始化，配置，并且组装上述的beans。一般，容器通过XML，或者Java注解，或者Java代码来配置对象。</p><p>通常在应用中，会创建<code>ClassPathXmlApplicationContext</code> 或者 <code>FileSystemXmlApplicationContext.</code> 的实例，来读取XML配置，并根据XML组装对象。</p><p>下图是高度抽象的视图，描述了spring是如何工作的。 {%raw%} <!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->Spring 容器<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->POJOs<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->配置<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->配置好的，可以使用的系统<!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted --><!-- raw HTML omitted -->生产对象<!-- raw HTML omitted --><!-- raw HTML omitted --> {%endraw%}</p><h2 id="配置">配置</h2><p>Spring配置通常有至少一个被容器管理的bean组成。基于XML配置，是在顶层<code>&lt;beans/&gt;</code>中配置 <code>&lt;bean/&gt;</code>元素。基于Java配置的，通常是<code>@Configuration</code>注解的类中的<code>@Bean</code>注解的方法。 基于XML配置的数据如下：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
<span style="color:#f92672">&lt;beans</span> <span style="color:#a6e22e">xmlns=</span><span style="color:#e6db74">&#34;http://www.springframework.org/schema/beans&#34;</span>
       <span style="color:#a6e22e">xmlns:xsi=</span><span style="color:#e6db74">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span>
       <span style="color:#a6e22e">xsi:schemaLocation=</span><span style="color:#e6db74">&#34;http://www.springframework.org/schema/beans
</span><span style="color:#e6db74">            http://www.springframework.org/schema/beans/spring-beans.xsd&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;import</span> <span style="color:#a6e22e">resource=</span><span style="color:#e6db74">&#34;resources/messageSource.xml&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;example1&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;com.spring.Example1&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#75715e">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>
    <span style="color:#f92672">&lt;/bean&gt;</span>
    <span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;example2&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;com.spring.Example2&#34;</span><span style="color:#f92672">&gt;</span>
        <span style="color:#75715e">&lt;!-- collaborators and configuration for this bean go here --&gt;</span>
    <span style="color:#f92672">&lt;/bean&gt;</span>
    <span style="color:#75715e">&lt;!-- more bean definitions go here --&gt;</span>
<span style="color:#f92672">&lt;/beans&gt;</span>
</code></pre></div><p>我们可以通过如下方式获取一个<code>ApplicationContext</code>:</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">ApplicationContext context <span style="color:#f92672">=</span>
<span style="color:#66d9ef">new</span> ClassPathXmlApplicationContext<span style="color:#f92672">(</span><span style="color:#66d9ef">new</span> String<span style="color:#f92672">[]</span> <span style="color:#f92672">{</span><span style="color:#e6db74">&#34;services.xml&#34;</span><span style="color:#f92672">,</span> <span style="color:#e6db74">&#34;daos.xml&#34;</span><span style="color:#f92672">});</span>
Example1 example1 <span style="color:#f92672">=</span> context<span style="color:#f92672">.</span><span style="color:#a6e22e">getBean</span><span style="color:#f92672">(</span><span style="color:#e6db74">&#34;example1&#34;</span><span style="color:#f92672">,</span> Example<span style="color:#f92672">.</span><span style="color:#a6e22e">class</span><span style="color:#f92672">);</span>
</code></pre></div><p>我们可以通过 <code>ApplicationContext</code> 接口的 <code>getBean()</code> 方法从Spring获取对象，但是这样会产生对Spring APIs的依赖，所以不建议这么做。我们可以通过框架来注入依赖。</p><h3 id="bean-定义">Bean 定义</h3><p>我们可以使用如下属性来定义一个Bean元素</p><table><thead><tr><th align="left">属性</th><th align="left">描述</th></tr></thead><tbody><tr><td align="left">class</td><td align="left">bean 的类路径</td></tr><tr><td align="left">name</td><td align="left">bean 的名字</td></tr><tr><td align="left">scope</td><td align="left">bean 的生命周期</td></tr><tr><td align="left">constructor arguments</td><td align="left">注入的构造参数</td></tr><tr><td align="left">properties</td><td align="left">注入的属性值</td></tr><tr><td align="left">autowiring mode</td><td align="left">自动注入模式</td></tr><tr><td align="left">lazy-initialization mode</td><td align="left">懒加载模式</td></tr><tr><td align="left">initialization method</td><td align="left">初始化方法</td></tr><tr><td align="left">destruction method</td><td align="left">销毁方法</td></tr></tbody></table><p>我们还可以将在容器外创建的对象加入到Spring容器中：通过 <code>ApplicationContext</code> 的 <code>getBeanFactory()</code> 方法获取到 <code>BeanFactory</code>，然后通过 <code>registerSingleton(...)</code> 或者 <code>registerBeanDefinition(...)</code> 来注册到容器中。</p><h3 id="bean-命名">Bean 命名</h3><p>每个Bean都有一个或多个标识符，标识符在容器中必须唯一。如果我们不提供标识符（id 或 name)，容器会为该Bean生成一个唯一的标识符。</p><p>我们可以用 <code>alias</code> 为 Bean 定义一个别名：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;alias</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;subsystemA-dataSource&#34;</span> <span style="color:#a6e22e">alias=</span><span style="color:#e6db74">&#34;subsystemB-dataSource&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><h3 id="bean-初始化">Bean 初始化</h3><p>如果是基于XML配置的容器，我们通过<code>&lt;bean/&gt;</code> 标签中的 <code>class</code> 属性来指定对象的类型。对于内部静态类，我们需要在 bean 的class 属性中，用 &ldquo;$&rdquo; 分隔。如果 <code>com.example.Foo</code> 中有一个静态内部类 <code>Bar</code>，那么 bean 的 class 属性应该写为： <code>com.example.Foo$Bar</code> 构造Bean的方法有： 构造器、静态工厂方法、对象的工厂方法：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"> <span style="color:#75715e">&lt;!-- 静态工厂方法构造bean --&gt;</span>
<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;clientService&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;com.examples.ClientService&#34;</span> <span style="color:#a6e22e">factory-method=</span><span style="color:#e6db74">&#34;createInstance&#34;</span><span style="color:#f92672">/&gt;</span>

<span style="color:#75715e">&lt;!-- 对象的工厂方法构造 bean --&gt;</span>
<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;clientService2&#34;</span> <span style="color:#a6e22e">factory-bean=</span><span style="color:#e6db74">&#34;clientService&#34;</span> <span style="color:#a6e22e">factory-method=</span><span style="color:#e6db74">&#34;createClient&#34;</span> <span style="color:#f92672">/&gt;</span>
</code></pre></div><h2 id="依赖">依赖</h2><p>Denpendency Injection 有两种主要的方式：基于构造方法的 和 基于Setter的</p><h3 id="基于构造方式">基于构造方式</h3><p>基于构造方式的DI是通过容器调用多个参数的构造器来完成的，每个参数表示一个依赖关系。 如果构造参数中不存在歧义，那么在bean定义构造参数的顺序就是其构造器参数的顺序。对于如下bean：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> x.y<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Foo</span> <span style="color:#f92672">{</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">Foo</span><span style="color:#f92672">(</span>Bar bar<span style="color:#f92672">,</span> Baz baz<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
    <span style="color:#75715e">// ...
</span><span style="color:#75715e"></span>    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>因为<code>Foo</code>构造器的两个参数<code>Bar</code>和<code>Baz</code>不存在歧义，所以顺序或者类型可以不明确提供。其xml中bean的定义可以写成：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;foo&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;x.y.Foo&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;bar&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">ref=</span><span style="color:#e6db74">&#34;baz&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>
<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;bar&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;x.y.Bar&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;baz&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;x.y.Baz&#34;</span><span style="color:#f92672">/&gt;</span>
</code></pre></div><p>对于基础类型，Spring不能判断其类型是什么，像<code>&lt;value&gt;true&lt;/value&gt;</code>，所以我们要提供一些额外的信息。</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java"><span style="color:#f92672">package</span> examples<span style="color:#f92672">;</span>
<span style="color:#66d9ef">public</span> <span style="color:#66d9ef">class</span> <span style="color:#a6e22e">ExampleBean</span> <span style="color:#f92672">{</span>
    <span style="color:#f92672">...</span>
    <span style="color:#66d9ef">public</span> <span style="color:#a6e22e">ExampleBean</span><span style="color:#f92672">(</span><span style="color:#66d9ef">int</span> years<span style="color:#f92672">,</span> String ultimateAnswer<span style="color:#f92672">)</span> <span style="color:#f92672">{</span>
        <span style="color:#f92672">...</span>
    <span style="color:#f92672">}</span>
<span style="color:#f92672">}</span>
</code></pre></div><p>上述例子中，我们可以使用<code>type</code>属性提供类型：</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;exampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.ExampleBean&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;int&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;7500000&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">type=</span><span style="color:#e6db74">&#34;java.lang.String&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;42&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>
</code></pre></div><p>还可以使用<code>index</code>属性来指定参数的顺序，<code>index</code> 是从0开始的:</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;exampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.ExampleBean&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">index=</span><span style="color:#e6db74">&#34;0&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;7500000&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">index=</span><span style="color:#e6db74">&#34;1&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;42&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>
</code></pre></div><p>还可以通过指定构造参数的名字来消除歧义:</p><div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-xml" data-lang="xml"><span style="color:#f92672">&lt;bean</span> <span style="color:#a6e22e">id=</span><span style="color:#e6db74">&#34;exampleBean&#34;</span> <span style="color:#a6e22e">class=</span><span style="color:#e6db74">&#34;examples.ExampleBean&#34;</span><span style="color:#f92672">&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;years&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;7500000&#34;</span><span style="color:#f92672">/&gt;</span>
    <span style="color:#f92672">&lt;constructor-arg</span> <span style="color:#a6e22e">name=</span><span style="color:#e6db74">&#34;ultimateAnswer&#34;</span> <span style="color:#a6e22e">value=</span><span style="color:#e6db74">&#34;42&#34;</span><span style="color:#f92672">/&gt;</span>
<span style="color:#f92672">&lt;/bean&gt;</span>
</code></pre></div><h3 id="基于-setter-来构造bean">基于 Setter 来构造bean</h3><p>基于 Setter 来构造bean是通过容器调用无参构造或者无参静态工厂方法构造出bean后，通过调用setter方法注入属性实现的。</p></article></div><div class="card-action"><div class="comments"><div id="disqus_thread"></div></div><script type="text/javascript">var disqus_shortname = 'wzhongke';

     
    (function() {
        var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();</script><noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript></div></div><div class="pagination-single"><span class="pagination-item previous"><i class="material-icons">navigate_before</i> <a href="https://wzhongke.github.io/post/node/" rel="prev">node</a> </span><span class="pagination-item next"><i class="material-icons">navigate_next</i> <a href="https://wzhongke.github.io/post/java/springboot&#43;prometheus/" rel="next">Springboot2 &#43; Prometheus 监控</a></span></div></div></section></div></section><footer class="page-footer"><div class="container"><div class="row"><div class="col l6 s12"><h5 class="white-text">World of Wang</h5><p class="grey-text text-lighten-4">Theme <a href="https://github.com/stkevintan/hugo-YAMT-theme" target="_blank">YAMT</a> designed by <a href="https://github.com/stkevintan" target="_blank">Kevin Tan</a> with ❤</p></div><div class="col l4 offset-l2 s12"><h5 class="white-text">My Friends</h5><ul><li><a class="grey-text text-lighten-3" href="https://frantic1048.logdown.com/" target="_blank">Frantic1048</a></li></ul></div></div></div><div class="footer-copyright"><div class="container">Copyright@Kevin Tan</div></div></footer></main><script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script><script>hljs.initHighlightingOnLoad();</script><script type="text/javascript" src="//dlweb.sogoucdn.com/common/lib/jquery/jquery-1.11.0.min.js"></script><script type="text/javascript" src="//cdn.bootcss.com/lunr.js/2.1.2/lunr.min.js"></script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
      tex2jax: {
        inlineMath: [['$','$'], ['\\(','\\)']]
      }
    });</script><script type="text/javascript" src="https://wzhongke.github.io//js/materialize.min.js"></script><script type="text/javascript" src="https://wzhongke.github.io//js/index-1c463e212c.js"></script><script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script><script>(adsbygoogle = window.adsbygoogle || []).push({
        google_ad_client: "ca-pub-9350854994277981",
        enable_page_level_ads: true
    });</script></body></html>