<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>mybatis | 壹叶知秋的博客 | 不要为恐惧所驾驭...</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="sql">
    <meta name="description" content="MyBatis是什么MyBatis是定制化SQL、存储过程以及高级映射的持久层框架。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。">
<meta name="keywords" content="sql">
<meta property="og:type" content="article">
<meta property="og:title" content="mybatis">
<meta property="og:url" content="http://wzhongke.github.io/2017/07/21/java/mybatis/index.html">
<meta property="og:site_name" content="壹叶知秋的博客">
<meta property="og:description" content="MyBatis是什么MyBatis是定制化SQL、存储过程以及高级映射的持久层框架。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。">
<meta property="og:locale" content="zh-CN">
<meta property="og:updated_time" content="2017-11-16T05:04:44.110Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="mybatis">
<meta name="twitter:description" content="MyBatis是什么MyBatis是定制化SQL、存储过程以及高级映射的持久层框架。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="/css/style.css">
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
    <script>
        (adsbygoogle = window.adsbygoogle || []).push({
            google_ad_client: "ca-pub-9350854994277981",
            enable_page_level_ads: true
        });
    </script>
    <script>
        (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
            (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
            m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
        })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

        ga('create', 'UA-105841950-1', 'auto');
        ga('send', 'pageview');

    </script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/sign.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">壹叶知秋</h5>
          <a href="mailto:993287653@qq.com" title="993287653@qq.com" class="mail">993287653@qq.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/wzhongke" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">mybatis</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">mybatis</h1>
        <h5 class="subtitle">
            
                <time datetime="2017-07-20T16:05:42.000Z" itemprop="datePublished" class="page-time">
  2017-07-20
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/sql/">sql</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#MyBatis是什么"><span class="post-toc-number">1.</span> <span class="post-toc-text">MyBatis是什么</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#开始入门"><span class="post-toc-number">2.</span> <span class="post-toc-text">开始入门</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#maven导入MyBatis包"><span class="post-toc-number">2.1.</span> <span class="post-toc-text">maven导入MyBatis包</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#使用XML构建SqlSessionFactory"><span class="post-toc-number">2.2.</span> <span class="post-toc-text">使用XML构建SqlSessionFactory</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#不使用XML构建SqlSessionFactory"><span class="post-toc-number">2.3.</span> <span class="post-toc-text">不使用XML构建SqlSessionFactory</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#从SqlSessionFactory中获取SqlSession"><span class="post-toc-number">2.4.</span> <span class="post-toc-text">从SqlSessionFactory中获取SqlSession</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#作用域和生命周期"><span class="post-toc-number">2.5.</span> <span class="post-toc-text">作用域和生命周期</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SqlSessionFactoryBuilder"><span class="post-toc-number">2.5.1.</span> <span class="post-toc-text">SqlSessionFactoryBuilder</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SqlSessionFactory"><span class="post-toc-number">2.5.2.</span> <span class="post-toc-text">SqlSessionFactory</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#SqlSession"><span class="post-toc-number">2.5.3.</span> <span class="post-toc-text">SqlSession</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#映射器实例"><span class="post-toc-number">2.5.4.</span> <span class="post-toc-text">映射器实例</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#XML映射配置文件"><span class="post-toc-number">3.</span> <span class="post-toc-text">XML映射配置文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#properties"><span class="post-toc-number">3.1.</span> <span class="post-toc-text">properties</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#settings"><span class="post-toc-number">3.2.</span> <span class="post-toc-text">settings</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#typeAliases"><span class="post-toc-number">3.3.</span> <span class="post-toc-text">typeAliases</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#typeHandlers"><span class="post-toc-number">3.4.</span> <span class="post-toc-text">typeHandlers</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#处理枚举类"><span class="post-toc-number">3.5.</span> <span class="post-toc-text">处理枚举类</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#对象工厂"><span class="post-toc-number">3.6.</span> <span class="post-toc-text">对象工厂</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#插件"><span class="post-toc-number">3.7.</span> <span class="post-toc-text">插件</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#配置环境"><span class="post-toc-number">3.8.</span> <span class="post-toc-text">配置环境</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#dataSource-数据源"><span class="post-toc-number">3.8.1.</span> <span class="post-toc-text">dataSource 数据源</span></a></li></ol></li></ol></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Mapper-XML映射文件"><span class="post-toc-number">4.</span> <span class="post-toc-text">Mapper XML映射文件</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#select"><span class="post-toc-number">4.1.</span> <span class="post-toc-text">select</span></a></li></ol></li></ol>
        </nav>
    </aside>
    
<article id="post-java/mybatis"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">mybatis</h1>
        <div class="post-meta">
            <time class="post-time" title="2017-07-20 16:05:42" datetime="2017-07-20T16:05:42.000Z"  itemprop="datePublished">2017-07-20</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/sql/">sql</a></li></ul>



            

        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="MyBatis是什么"><a href="#MyBatis是什么" class="headerlink" title="MyBatis是什么"></a>MyBatis是什么</h1><p>MyBatis是定制化SQL、存储过程以及高级映射的持久层框架。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接口和 Java 的 POJOs(Plain Old Java Objects,普通的 Java对象)映射成数据库中的记录。<br><a id="more"></a></p>
<h1 id="开始入门"><a href="#开始入门" class="headerlink" title="开始入门"></a>开始入门</h1><h2 id="maven导入MyBatis包"><a href="#maven导入MyBatis包" class="headerlink" title="maven导入MyBatis包"></a>maven导入MyBatis包</h2><p>在<code>pom.xml</code>的<code>dependencies</code>下添加如下依赖：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;!-- https://mvnrepository.com/artifact/org.mybatis/mybatis --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.mybatis&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;mybatis&lt;/artifactId&gt;</div><div class="line">    &lt;version&gt;3.4.4&lt;/version&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure></p>
<p>MyBatis是中心是<code>SqlSessionFactory</code>实例，该实例通过<code>SqlSessionFactoryBuilder</code>获得。<code>SqlSessionFactoryBuilder</code>可以通过XML配置或使用<code>Configuration</code>构建。</p>
<h2 id="使用XML构建SqlSessionFactory"><a href="#使用XML构建SqlSessionFactory" class="headerlink" title="使用XML构建SqlSessionFactory"></a>使用XML构建<code>SqlSessionFactory</code></h2><p>XML配置文件包含了MyBatis系统的核心配置，包含数据库连接实例的数据源和决定事务作用域和控制方式的事务管理器。下面是配置中比较关键的部分：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</div><div class="line">&lt;!DOCTYPE configuration</div><div class="line">  PUBLIC &quot;-//mybatis.org//DTD Config 3.0//EN&quot;</div><div class="line">  &quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;&gt;</div><div class="line">&lt;configuration&gt;</div><div class="line">  &lt;environments default=&quot;development&quot;&gt;</div><div class="line">    &lt;environment id=&quot;development&quot;&gt;</div><div class="line">      &lt;transactionManager type=&quot;JDBC&quot;/&gt;</div><div class="line">      &lt;dataSource type=&quot;POOLED&quot;&gt;</div><div class="line">        &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</div><div class="line">        &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</div><div class="line">        &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</div><div class="line">        &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</div><div class="line">      &lt;/dataSource&gt;</div><div class="line">    &lt;/environment&gt;</div><div class="line">  &lt;/environments&gt;</div><div class="line">  &lt;mappers&gt;</div><div class="line">    &lt;mapper resource=&quot;mybatis/mapper/PersonMapper.xml&quot;/&gt;</div><div class="line">  &lt;/mappers&gt;</div><div class="line">&lt;/configuration&gt;</div></pre></td></tr></table></figure></p>
<p>要注意XML头部的声明，该声明用来验证XML文档正确性。<code>environment</code>元素中包含了事务管理和连接池的配置。<code>mappers</code>元素包含一组<code>mapper</code>映射器。<br>我们可以通过Mybatis的一个<code>Resources</code>工具类从classpath或其他位置加载配置文件。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">String resource = &quot;mybatis.xml&quot;;</div><div class="line">InputStream confStream = Resources.getResourceAsStream(resource);</div><div class="line">SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(confStream);</div></pre></td></tr></table></figure></p>
<h2 id="不使用XML构建SqlSessionFactory"><a href="#不使用XML构建SqlSessionFactory" class="headerlink" title="不使用XML构建SqlSessionFactory"></a>不使用XML构建<code>SqlSessionFactory</code></h2><p>如果不想依赖配置构建程序，那么可以使用Java程序构建configuration，MyBatis提供了完全不用XML配置的类：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">DataSource dataSource = BlogDataSourceFactory.getBlogDataSource();</div><div class="line">TransactionFactory transactionFactory = new JdbcTransactionFactory();</div><div class="line">Environment environment = new Environment(&quot;development&quot;, transactionFactory, dataSource);</div><div class="line">Configuration configuration = new Configuration(environment);</div><div class="line">configuration.addMapper(BlogMapper.class);</div><div class="line">SqlSessionFactory sqlSessionFactory = new SqlSessionFactoryBuilder().build(configuration);</div></pre></td></tr></table></figure></p>
<h2 id="从SqlSessionFactory中获取SqlSession"><a href="#从SqlSessionFactory中获取SqlSession" class="headerlink" title="从SqlSessionFactory中获取SqlSession"></a>从<code>SqlSessionFactory</code>中获取<code>SqlSession</code></h2><p><code>SqlSession</code>中包含了面向数据库执行SQL命令所有的方法，可以通过<code>SqlSession</code>实例来直接执行已经映射的SQL语句：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">try (SqlSession session = sqlSessionFactory.openSession()) &#123;</div><div class="line">	Person person = session.selectOne(&quot;mybatis.mapper.PersonMapper.selectPerson&quot;, 101);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>上例中需要<code>PersonMapper.xml</code>配置项：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;mapper namespace=&quot;mybatis.mapper.PersonMapper&quot;&gt;</div><div class="line">    &lt;select id=&quot;selectPerson&quot; resultType=&quot;mybatis.dao.Person&quot; parameterType=&quot;int&quot;&gt;</div><div class="line">        SELECT * FROM Person WHERE id = #&#123;id&#125;</div><div class="line">    &lt;/select&gt;</div><div class="line">&lt;/mapper&gt;</div></pre></td></tr></table></figure></p>
<p>在一个XML映射文件中，可以定义任意多个映射语句，而且具有很好的自解释性。在命名空间<code>mybatis.mapper.PersonMapper</code>中定义了一个名为<code>selectBlog</code>的映射语句，这样就可以像上例中那样调用查询语句。<br>我们还可以不使用XML配置，使用注解来实现同样的功能<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">public interface PersonMapper &#123;</div><div class="line">    @Select(&quot;SELECT * FROM blog WHERE id = #&#123;id&#125;&quot;)</div><div class="line">    Person selectPerson(int id);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>对于简单的语句，用Java注解简洁清晰；但是对于复杂的语句，就显得有些混乱，那么可以使用XML映射语句。这两种方式可以自由移植和切换。</p>
<h2 id="作用域和生命周期"><a href="#作用域和生命周期" class="headerlink" title="作用域和生命周期"></a>作用域和生命周期</h2><blockquote>
<p>如果使用依赖注入的框架，如spring，则可以直接忽略他们的生命周期。因为这些框架可以创建线程安全的、基于事务的<code>SqlSession</code>和映射器，并将他们注入到bean中。</p>
<h3 id="SqlSessionFactoryBuilder"><a href="#SqlSessionFactoryBuilder" class="headerlink" title="SqlSessionFactoryBuilder"></a><code>SqlSessionFactoryBuilder</code></h3><p>该类可以被实例化、使用和丢弃，一旦创建了<code>SqlSessionFactory</code>，就可以不再用它了。因此<code>SqlSessionFactoryBuilder</code>实例最佳作用域是局部变量。可以重用<code>SqlSessionFactoryBuilder</code>来创建多个<code>SqlSessionFactory</code>实例。但是不要让其一直存在，避免一直占有资源。</p>
<h3 id="SqlSessionFactory"><a href="#SqlSessionFactory" class="headerlink" title="SqlSessionFactory"></a><code>SqlSessionFactory</code></h3><p><code>SqlSessionFactory</code>实例一旦创建，就应该在运行期间一直存在，对其清除和重建是浪费资源的。因此<code>SqlSessionFactory</code>的最佳作用域是应用级的，可以用单例模式或者静态单例模式创建</p>
<h3 id="SqlSession"><a href="#SqlSession" class="headerlink" title="SqlSession"></a><code>SqlSession</code></h3><p>每个线程都应该有它自己的 SqlSession 实例。SqlSession 的实例不是线程安全的，因此是不能被共享的，所以它的最佳的作用域是请求或方法作用域。绝对不能将 SqlSession 实例的引用放在一个类的静态域，甚至一个类的实例变量也不行。也绝不能将<code>SqlSession</code>实例的引用放在任何类型的管理作用域中。简单概括来说，就是使用之前，创建；使用完之后，马上关闭。<code>SqlSession</code>实现了<code>Closeable</code>，因此可以使用自动关闭的特性：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">try (SqlSession session = sqlSessionFactory.openSession()) &#123;</div><div class="line">	Person person = session.selectOne(&quot;mybatis.mapper.PersonMapper.selectPerson&quot;, 101);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
</blockquote>
<h3 id="映射器实例"><a href="#映射器实例" class="headerlink" title="映射器实例"></a>映射器实例</h3><p>映射器是用来绑定映射语句的接口，该实例是从<code>SqlSession</code>中获取的，所以映射器的作用域同<code>SqlSession</code>相同，其最佳作用域是方法作用域。</p>
<h1 id="XML映射配置文件"><a href="#XML映射配置文件" class="headerlink" title="XML映射配置文件"></a>XML映射配置文件</h1><p>MyBatis配置文件的层次结构如下<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">-- configuration</div><div class="line">   -- properties</div><div class="line">   -- settings</div><div class="line">   -- typeAliases</div><div class="line">   -- typeHandlers</div><div class="line">   -- objectFactory</div><div class="line">   -- plugins</div><div class="line">   -- environments</div><div class="line">      -- environment</div><div class="line">         -- transactionManager</div><div class="line">         -- dataSource</div><div class="line">   -- databaseIdProvider</div><div class="line">   -- mappers</div></pre></td></tr></table></figure></p>
<h2 id="properties"><a href="#properties" class="headerlink" title="properties"></a><code>properties</code></h2><p>这些属性相当于定义的变量，可以在Java属性文件中配置，也可以通过properties元素子元素传递：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;properties resource=&quot;jdbc.properties&quot;&gt;</div><div class="line">    &lt;property name=&quot;username&quot; value=&quot;dev_user&quot;/&gt;</div><div class="line">    &lt;property name=&quot;password&quot; value=&quot;F2Fa3!33TYyg&quot;/&gt;</div><div class="line">&lt;/properties&gt;</div></pre></td></tr></table></figure></p>
<p>中期的属性可以在这个配置文件中使用：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;dataSource type=&quot;POOLED&quot;&gt;</div><div class="line">    &lt;property name=&quot;driver&quot; value=&quot;$&#123;driver&#125;&quot;/&gt;</div><div class="line">    &lt;property name=&quot;url&quot; value=&quot;$&#123;url&#125;&quot;/&gt;</div><div class="line">    &lt;property name=&quot;username&quot; value=&quot;$&#123;username&#125;&quot;/&gt;</div><div class="line">    &lt;property name=&quot;password&quot; value=&quot;$&#123;password&#125;&quot;/&gt;</div><div class="line">&lt;/dataSource&gt;</div></pre></td></tr></table></figure></p>
<p>上例中<code>username</code>和<code>password</code>会由<code>properties</code>元素中相应的值来替换，<code>driver</code>和<code>url</code>属性取自<code>jdbc.properties</code>。<br>如果在多个地方配置了属性，那么会按照下面对顺序来加载：</p>
<ol>
<li>首先读取<code>properties</code>元素体内指定的属性</li>
<li>然后根据<code>properties</code>中的<code>resource</code>属性读取类路径下属性文件或根据<code>url</code>属性指定读取属性文件，并覆盖已读取的同名属性。</li>
<li>最后读取作为方法参数传递的属性，并覆盖已读取的同名属性。<br>从MyBatis3.4.2开始，可以用占位符指定一个默认值。：<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;dataSource type=&quot;POOLED&quot;&gt;</div><div class="line">  &lt;property name=&quot;username&quot; value=&quot;$&#123;username:ut_user&#125;&quot;/&gt; &lt;!-- 如果&apos;username&apos;不存在, username 取值为&apos;ut_user&apos; --&gt;</div><div class="line">&lt;/dataSource&gt;</div></pre></td></tr></table></figure>
</li>
</ol>
<p>这个特性默认是关闭的，需要在<code>properties</code>下，用指定的属性来开启此特性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;properties&gt;</div><div class="line">&lt;property name=&quot;org.apache.ibatis.parsing.PropertyParser.enable-default-value&quot; value=&quot;true&quot;/&gt;</div><div class="line">&lt;/properties&gt;</div></pre></td></tr></table></figure></p>
<h2 id="settings"><a href="#settings" class="headerlink" title="settings"></a>settings</h2><p>这是MyBatis中极为重要的调整设置，他们会改变MyBatis的运行时行为：</p>
<table>
<thead>
<tr>
<th style="text-align:left">设置参数</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">取值</th>
<th style="text-align:left">默认值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">cacheEnabled</td>
<td style="text-align:left">该配置影响所有映射器中配置的缓存的全局开关</td>
<td style="text-align:left">true/false</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">lazyLoadingEnabled</td>
<td style="text-align:left">延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置<code>fetchType</code>属性来覆盖该项的开关状态.</td>
<td style="text-align:left">true/false</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">aggressiveLazyLoading</td>
<td style="text-align:left">当开启时，任何方法的调用都会加载该对象的所有属性。否则，每个属性会按需加载（参考<code>lazyLoadTriggerMethods</code>).</td>
<td style="text-align:left">true\false</td>
<td style="text-align:left">false (true in ≤3.4.1)</td>
</tr>
<tr>
<td style="text-align:left">multipleResultSetsEnabled</td>
<td style="text-align:left">是否允许单一语句返回多结果集（需要兼容驱动）</td>
<td style="text-align:left">true\false</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">useColumnLabel</td>
<td style="text-align:left">使用列标签代替列名。不同的驱动在这方面会有不同的表现， 具体可参考相关驱动文档或通过测试这两种不同的模式来观察所用驱动的结果</td>
<td style="text-align:left">true\false</td>
<td style="text-align:left">true</td>
</tr>
<tr>
<td style="text-align:left">useGeneratedKeys</td>
<td style="text-align:left">允许 JDBC 支持自动生成主键，需要驱动兼容。 如果设置为 true 则这个设置强制使用自动生成主键，尽管一些驱动不能兼容但仍可正常工作</td>
<td style="text-align:left">true/false</td>
<td style="text-align:left">false</td>
</tr>
<tr>
<td style="text-align:left">autoMappingBehavior</td>
<td style="text-align:left">指定 MyBatis 应如何自动映射列到字段或属性。 NONE 表示取消自动映射；PARTIAL 只会自动映射没有定义嵌套结果集映射的结果集。 FULL 会自动映射任意复杂的结果集（无论是否嵌套）</td>
<td style="text-align:left">NONE,PARTIAL,FULL</td>
<td style="text-align:left">PARTIAL</td>
</tr>
<tr>
<td style="text-align:left">autoMappingUnknownColumnBehavior</td>
<td style="text-align:left">指定发现自动映射目标未知列（或者未知属性类型）的行为</td>
<td style="text-align:left">NONE, WARNING, FAILING</td>
<td style="text-align:left">NONE</td>
</tr>
<tr>
<td style="text-align:left">defaultExecutorType</td>
<td style="text-align:left">配置默认的执行器。SIMPLE 就是普通的执行器；REUSE 执行器会重用预处理语句（prepared statements）； BATCH 执行器将重用语句并执行批量更新</td>
<td style="text-align:left">SIMPLE REUSE BATCH</td>
<td style="text-align:left">SIMPLE</td>
</tr>
</tbody>
</table>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 该配置影响的所有映射器中配置的缓存的全局开关。 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"cacheEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 延迟加载的全局开关。当开启时，所有关联对象都会延迟加载。 特定关联关系中可通过设置fetchType属性来覆盖该项的开关状态。--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadingEnabled"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 是否允许单一语句返回多结果集（需要兼容驱动）。 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"multipleResultSetsEnabled"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 使用列标签代替列名。不同的驱动在这方面会有不同的表现， 具体可参考相关驱动文档或通过测试这两种不同的模式来观察所用驱动的结果。 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useColumnLabel"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 允许 JDBC 支持自动生成主键，需要驱动兼容。 如果设置为 true 则这个设置强制使用自动生成主键，尽管一些驱动不能兼容但仍可正常工作（比如 Derby）。  --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"useGeneratedKeys"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 指定 MyBatis 应如何自动映射列到字段或属性。</span></div><div class="line"><span class="comment">        NONE 表示取消自动映射；</span></div><div class="line"><span class="comment">        PARTIAL 只会自动映射没有定义嵌套结果集映射的结果集。</span></div><div class="line"><span class="comment">        FULL 会自动映射任意复杂的结果集（无论是否嵌套）。--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"autoMappingBehavior"</span> <span class="attr">value</span>=<span class="string">"PARTIAL"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 指定发现自动映射目标未知列（或者未知属性类型）的行为。</span></div><div class="line"><span class="comment">            NONE: 不做任何反应</span></div><div class="line"><span class="comment">            WARNING: 输出提醒日志 ('org.apache.ibatis.session.AutoMappingUnknownColumnBehavior' 的日志等级必须设置为 WARN)</span></div><div class="line"><span class="comment">            FAILING: 映射失败 (抛出 SqlSessionException) --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"autoMappingUnknownColumnBehavior"</span> <span class="attr">value</span>=<span class="string">"WARNING"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!--    配置默认的执行器。</span></div><div class="line"><span class="comment">                SIMPLE 就是普通的执行器；</span></div><div class="line"><span class="comment">                REUSE 执行器会重用预处理语句（prepared statements）；</span></div><div class="line"><span class="comment">                BATCH 执行器将重用语句并执行批量更新。 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultExecutorType"</span> <span class="attr">value</span>=<span class="string">"SIMPLE"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 设置超时时间，它决定驱动等待数据库响应的秒数。(任意正整数) --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultStatementTimeout"</span> <span class="attr">value</span>=<span class="string">"25"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 为驱动的结果集获取数量（fetchSize）设置一个提示值。此参数只可以在查询设置中被覆盖。 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"defaultFetchSize"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 允许在嵌套语句中使用分页（RowBounds）。 If allow, set the false. --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"safeRowBoundsEnabled"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 是否开启自动驼峰命名规则（camel case）映射，即从经典数据库列名 A_COLUMN 到经典 Java 属性名 aColumn 的类似映射。 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"mapUnderscoreToCamelCase"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- MyBatis 利用本地缓存机制（Local Cache）防止循环引用（circular references）和加速重复嵌套查询。</span></div><div class="line"><span class="comment">       默认值为 SESSION，这种情况下会缓存一个会话中执行的所有查询。</span></div><div class="line"><span class="comment">       若设置值为 STATEMENT，本地会话仅用在语句执行上， 对相同 SqlSession 的不同调用将不会共享数据。 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"localCacheScope"</span> <span class="attr">value</span>=<span class="string">"SESSION"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 当没有为参数提供特定的 JDBC 类型时，为空值指定 JDBC 类型。 某些驱动需要指定列的 JDBC 类型，</span></div><div class="line"><span class="comment">        多数情况直接用一般类型即可，比如 NULL、VARCHAR 或 OTHER。--&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"jdbcTypeForNull"</span> <span class="attr">value</span>=<span class="string">"OTHER"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 指定哪个对象的方法触发一次延迟加载。 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"lazyLoadTriggerMethods"</span> <span class="attr">value</span>=<span class="string">"equals,clone,hashCode,toString"</span>/&gt;</span></div><div class="line">    <span class="comment">&lt;!-- 指定 MyBatis 增加到日志名称的前缀。 --&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">"logPrefix"</span> <span class="attr">value</span>=<span class="string">"mybatis"</span> /&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a>typeAliases</h2><p>类型名是为Java类型设置一个短名字，只和XML配置有关，仅用来减少类完全限定名的冗余。比如：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Author"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Author"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Blog"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Blog"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Comment"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Comment"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Post"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Post"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Section"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Section"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"Tag"</span> <span class="attr">type</span>=<span class="string">"domain.blog.Tag"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>这样，就可以在使用<code>domain.blog.Blog</code>的地方用<code>Blog</code>替换。<br>还可以通过指定包名，来批量指定别名：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">&lt;typeAliases&gt;</div><div class="line">  &lt;package name=&quot;domain.blog&quot;/&gt;</div><div class="line">&lt;/typeAliases&gt;</div></pre></td></tr></table></figure></p>
<p>这样每个在包<code>domain.blog</code>中的Java对象，在没有注解的情况下，会使用该对象的首字母小写的类名来作为它的别名。如<code>domain.blog.Author</code>的别名为<code>author</code>；如果有注解，那么以注解值为准。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Alias</span>(<span class="string">"author"</span>)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Author</span> </span>&#123;</div><div class="line">    ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h2 id="typeHandlers"><a href="#typeHandlers" class="headerlink" title="typeHandlers"></a>typeHandlers</h2><p>无论在处理预处理语句中设置一个参数时，还是从结果集中取出一个值时，都会用到类型处理器将获取的值以合适的方式转换成Java类型。这就是类型处理器。<br>我们可以重写类型处理器或创建自己的类型处理器来处理不支持的或非标准的类型。具体做法：实现<code>org.apache.ibatis.type.TypeHandler</code>接口，或者继承类<code>org.apache.ibatis.type.BaseTypeHandler</code>，然后可以选择性地将它映射到一个JDBC类型：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@MappedJdbcTypes</span>(JdbcType.VARCHAR)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleTypeHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">String</span>&gt; </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement preparedStatement, <span class="keyword">int</span> i, String s, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        preparedStatement.setString(i, s);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(ResultSet resultSet, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        <span class="keyword">return</span> resultSet.getString(columnName);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        <span class="keyword">return</span> resultSet.getString(columnIndex);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getNullableResult</span><span class="params">(CallableStatement callableStatement, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;</div><div class="line">        <span class="keyword">return</span> callableStatement.getString(columnIndex);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个类需要在MyBatis的配置文件中配置：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">"org.mybatis.example.ExampleTypeHandler"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>使用这个的类型处理器将会覆盖已经存在的处理<code>Java</code>的<code>String</code>类型属性和<code>VARCHAR</code>参数及结果的类型处理器。</p>
<blockquote>
<p>MyBatis不会探测数据库元信息来决定使用哪种数据类型，所以必须在参数和结果映射中指明那个是<code>VARCHAR</code>类型的字段，以便能够绑定到正确的类型处理器上。</p>
</blockquote>
<p>通过类型处理器的泛型，MyBatis 可以得知该类型处理器处理的 Java 类型，不过这种行为可以通过两种方法改变：</p>
<ul>
<li>在类型处理器的配置元素（typeHandler element）上增加一个 javaType 属性（比如：javaType=”String”）；</li>
<li>在类型处理器的类上（TypeHandler class）增加一个 @MappedTypes 注解来指定与其关联的 Java 类型列表。 如果在 javaType 属性中也同时指定，则注解方式将被忽略。</li>
</ul>
<p>可以通过两种方式来指定被关联的 JDBC 类型：</p>
<ul>
<li>在类型处理器的配置元素上增加一个 jdbcType 属性（比如：jdbcType=”VARCHAR”）；</li>
<li>在类型处理器的类上（TypeHandler class）增加一个 @MappedJdbcTypes 注解来指定与其关联的 JDBC 类型列表。 如果在 jdbcType 属性中也同时指定，则注解方式将被忽略。</li>
</ul>
<p>我们还可以让MyBatis自动查找类型处理器，该方式只能通过注解方式来指定JDBC类型：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- mybatis-config.xml --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">"org.mybatis.example"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></div></pre></td></tr></table></figure></p>
<h2 id="处理枚举类"><a href="#处理枚举类" class="headerlink" title="处理枚举类"></a>处理枚举类</h2><p>若想映射枚举类型<code>Enum</code>，则需要从<code>EnumTypeHandler</code>或者<code>EnumOrdinalTypeHandler</code>中选一个来使用。</p>
<h2 id="对象工厂"><a href="#对象工厂" class="headerlink" title="对象工厂"></a>对象工厂</h2><p>MyBatis 每次创建结果对象的新实例时，它都会使用一个对象工厂（ObjectFactory）实例来完成。 默认的对象工厂需要做的仅仅是实例化目标类，要么通过默认构造方法，要么在参数映射存在的时候通过参数构造方法来实例化。 如果想覆盖对象工厂的默认行为，则可以通过创建自己的对象工厂来实现。比如：<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExampleObjectFactory</span> <span class="keyword">extends</span> <span class="title">DefaultObjectFactory</span> </span>&#123;</div><div class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">(Class type)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.create(type);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">(Class type, List&lt;Class&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.create(type, constructorArgTypes, constructorArgs);</div><div class="line">  &#125;</div><div class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</div><div class="line">    <span class="keyword">super</span>.setProperties(properties);</div><div class="line">  &#125;</div><div class="line">  <span class="keyword">public</span> &lt;T&gt; <span class="function"><span class="keyword">boolean</span> <span class="title">isCollection</span><span class="params">(Class&lt;T&gt; type)</span> </span>&#123;</div><div class="line">    <span class="keyword">return</span> Collection.class.isAssignableFrom(type);</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"><span class="comment">&lt;!-- mybatis-config.xml --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">objectFactory</span> <span class="attr">type</span>=<span class="string">"org.mybatis.example.ExampleObjectFactory"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"someProperty"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">objectFactory</span>&gt;</span></div></pre></td></tr></table></figure>
<h2 id="插件"><a href="#插件" class="headerlink" title="插件"></a>插件</h2><p>MyBatis允许你在已映射语句执行过程中的某一个点进行拦截调用。MyBatis允许使用插件拦截的调用有：</p>
<ul>
<li><code>Executor (update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</code></li>
<li><code>ParameterHandler (getParameterObject, setParameters)</code></li>
<li><code>ResultSetHandler (handleResultSets, handleOutputParameters)</code></li>
<li><code>StatementHandler (prepare, parameterize, batch, update, query)</code></li>
</ul>
<p>假设你想做的不仅仅是监控方法的调用，那么你应该很好的了解正在重写的方法的行为。 因为如果试图修改或重写已有方法，你很可能在破坏 MyBatis的核心模块。 这些都是更低层的类和方法，所以使用插件的时候要特别当心。<br>使用插件，只需要实现<code>Interceptor</code>接口，并指定想要拦截的方法签名即可。<br><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Intercepts</span>(&#123;</div><div class="line">    <span class="meta">@Signature</span>(</div><div class="line">        type = Executor.class,</div><div class="line">        method = <span class="string">"update"</span>,</div><div class="line">        args = &#123;MappedStatement.class, Object.class&#125;</div><div class="line">    )</div><div class="line">&#125;)</div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExamplePlugin</span> <span class="keyword">implements</span> <span class="title">Interceptor</span> </span>&#123;</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">intercept</span><span class="params">(Invocation invocation)</span> <span class="keyword">throws</span> Throwable </span>&#123;</div><div class="line">        <span class="keyword">return</span> invocation.proceed();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">plugin</span><span class="params">(Object o)</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> Plugin.wrap(o, <span class="keyword">this</span>);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123;</div><div class="line"></div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>配置文件中需要增加：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">"org.mybatis.example.ExamplePlugin"</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"someProperty"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span></div><div class="line">  <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></div></pre></td></tr></table></figure></p>
<p>上面的插件将会拦截在<code>Executor</code>实例中所有的 “update” 方法调用，这里的<code>Executor</code>是负责执行低层映射语句的内部对象。</p>
<h2 id="配置环境"><a href="#配置环境" class="headerlink" title="配置环境"></a>配置环境</h2><p>每个数据库应该对应至少一个<code>SqlSessionFactory</code>实例。<br>MyBatis中有两种类型的事务管理器（<code>type=&quot;[JDBC|MANAGED]&quot;</code>)</p>
<ul>
<li>JDBC: 这个配置就是直接使用了JDBC的提交和回滚设置，它依赖于从数据源得到的连接来管理事物作用域</li>
<li>MANAGED：这个配置将管理事务的整个生命周期的任务交给了容器。默认情况下它会关闭连接，然而一些容器并不希望这样，因此需要将 closeConnection 属性设置为 false 来阻止它默认的关闭行为。例如:<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"><span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">"MANAGED"</span>&gt;</span></div><div class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"closeConnection"</span> <span class="attr">value</span>=<span class="string">"false"</span>/&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">transactionManager</span>&gt;</span></div></pre></td></tr></table></figure>
</li>
</ul>
<blockquote>
<p>如果使用 Spring + MyBatis，则没有必要配置事务管理器， 因为 Spring 模块会使用自带的管理器来覆盖前面的配置。</p>
<h3 id="dataSource-数据源"><a href="#dataSource-数据源" class="headerlink" title="dataSource 数据源"></a>dataSource 数据源</h3><p>有三种内建的数据源类型 (<code>type=&quot;[UNPOLLED|POOLED|JNDI]&quot;</code>)</p>
<ol>
<li>UNPOOLED：每次被请求时打开和关闭连接</li>
<li>POOLED: 利用数据库连接池，避免了创建新的连接实例时所需要的初始化和认证时间，有比较多的属性可以配置：<ul>
<li><code>poolMaximumActiveConnections</code>: 最大连接数量</li>
<li><code>poolMaximumIdleConnections</code>: 最大空闲连接数</li>
<li><code>poolMaximumCheckoutTime</code>: 连接池中的连接被检出时间</li>
<li><code>poolTimeToWait</code>:  这是一个底层设置，如果获取连接花费的相当长的时间，它会给连接池打印状态日志并重新尝试获取一个连接</li>
<li><code>poolPingQuery</code>: 发送到数据库的侦测查询，用来检验连接是否处在正常工作秩序中并准备接受请求</li>
<li><code>poolPingEnabled</code>: 是否启用侦测查询。默认值<code>false</code>，启用是必须设置一个可执行的SQL语句作为<code>poolPingQuery</code>的值</li>
<li><code>poolPingConnectionsNotUsedFor</code>: 配置 poolPingQuery 的使用频度。</li>
</ul>
</li>
<li>JNDI: 在EJB或应用服务器类容器中使用</li>
</ol>
</blockquote>
<h1 id="Mapper-XML映射文件"><a href="#Mapper-XML映射文件" class="headerlink" title="Mapper XML映射文件"></a>Mapper XML映射文件</h1><p>XML SQL映射文件中有一下几个顶级元素：</p>
<ul>
<li><code>cache</code>: 给定命名空间的缓存配置</li>
<li><code>cache-ref</code>: 其他命名空间缓存配置的引用。</li>
<li><code>resultMap</code>: 是最复杂也是最强大的元素，用来描述如何从数据库结果集中来加载对象。</li>
<li><code>sql</code>: 可以被其他语句引用的重用块</li>
<li><code>insert</code>: 插入语句</li>
<li><code>update</code>: 更新语句</li>
<li><code>delete</code>: 删除语句</li>
<li><code>select</code>: 查询语句<h2 id="select"><a href="#select" class="headerlink" title="select"></a><code>select</code></h2>查询是数据库操作中应用最频繁的语句。MyBatis简单的<code>select</code>非常简单：<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"></div></pre></td></tr></table></figure></li>
</ul>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2017-11-16T05:04:44.110Z" itemprop="dateUpdated">2017-11-16 05:04:44</time>
</span><br>


        
    </div>
    <footer>
        <a href="http://wzhongke.github.io">
            <img src="/img/sign.jpg" alt="壹叶知秋">
            壹叶知秋
        </a>
    </footer>
</blockquote>

        


        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/sql/">sql</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://wzhongke.github.io/2017/07/21/java/mybatis/&title=《mybatis》 — 壹叶知秋的博客&pic=http://wzhongke.github.io/img/sign.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://wzhongke.github.io/2017/07/21/java/mybatis/&title=《mybatis》 — 壹叶知秋的博客&source=MyBatis是什么MyBatis是定制化SQL、存储过程以及高级映射的持久层框架。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://wzhongke.github.io/2017/07/21/java/mybatis/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《mybatis》 — 壹叶知秋的博客&url=http://wzhongke.github.io/2017/07/21/java/mybatis/&via=http://wzhongke.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://wzhongke.github.io/2017/07/21/java/mybatis/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2017/07/21/java/java中没有见过的用法/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">java中没有见过的用法</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2017/07/20/java/Lambda表达式和Stream/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Lambda表达式和Stream</h4>
      </a>
    </div>
  
</nav>



    














</article>



</div>

        <footer class="footer">
    <div class="top">
        

        <p>
            
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>壹叶知秋 &copy; 2015 - 2017</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://wzhongke.github.io/2017/07/21/java/mybatis/&title=《mybatis》 — 壹叶知秋的博客&pic=http://wzhongke.github.io/img/sign.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://wzhongke.github.io/2017/07/21/java/mybatis/&title=《mybatis》 — 壹叶知秋的博客&source=MyBatis是什么MyBatis是定制化SQL、存储过程以及高级映射的持久层框架。MyBatis 可以对配置和原生Map使用简单的 XML 或注解，将接..." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://wzhongke.github.io/2017/07/21/java/mybatis/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《mybatis》 — 壹叶知秋的博客&url=http://wzhongke.github.io/2017/07/21/java/mybatis/&via=http://wzhongke.github.io" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://wzhongke.github.io/2017/07/21/java/mybatis/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://wzhongke.github.io/2017/07/21/java/mybatis/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: false };


</script>

<script src="/css/style.css"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/css/style.css" async></script>








<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = '你走了';
            clearTimeout(titleTime);
        } else {
            document.title = '你来了';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



<script>
    var codes = document.getElementsByClassName("code");
    var length = codes.length;
    for (var i=0; i<length; i++) {
        codes[i].innerHTML =  codes[i].innerHTML.replace(/&lt;b&gt;(.*?)&lt;\/b&gt;/g, "<b>$1</b>");
        console.log(codes[i].innerHTML)
    }

    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
        (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
        m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-105841950-1', 'auto');
    ga('send', 'pageview');

</script>

</body>
</html>
