---
title: 结构型模式
---

# 转换接口的适配器 -- Adapter
将一个类的接口转换成客户希望的另外一个接口，Adapter模式使得原本由于接口不兼容而不能一起工作的那些类可以一起工作。

## 适用性
以下情况使用Adapter模式：
- 使用一个已经存在的类，而它的接口不符合需求
- 创建一个可复用的类，该类可以与其他不相关的类或不可预见的类协同工作
- 想使用一些已经存在的子类，但是不可能对每一个都进行子类化以匹配他们的接口，对象适配器可以适配它的父类接口

## 结构
类适配器使用多重继承对一个接口与另一个接口进行匹配：
{%raw%}
<svg xmlns="http://www.w3.org/2000/svg" viewBox="215.840909090909 46.0 662.3409090909091 269.1089406461307"><defs><marker id="a" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1" refY="3.899"><path d="M12 3.9L0 7.797V0z" stroke="#323232" stroke-width="2" fill="#fff"/></marker><marker id="b" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1" refY="3.899"><path d="M12 3.9L0 7.797V0z" stroke="#323232" stroke-width="2" fill="#fff"/></marker><marker id="c" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1" refY="3.899"><path d="M12 3.9L0 7.797V0z" stroke="#323232" stroke-width="2" fill="#323232"/></marker><marker id="d" markerUnits="userSpaceOnUse" orient="auto" markerWidth="10" markerHeight="10" viewBox="-1.0 -1.0 10.0 10.0" refX="8" refY="4"><path d="M0 4a4 4 0 0 1 4-4 4 4 0 1 1-4 4" stroke="#323232" stroke-width="2" fill="#fff"/></marker></defs><path d="M215.84 46h662.342v269.11h-662.34V46z" fill="none"/><path d="M403 70q0-4 4-4h98q4 0 4 4v56q0 4-4 4h-98q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#9cf"/><path d="M403 96h106" stroke="#323232" stroke-width="2" fill="none"/><path d="M403 66h106v64H403z" fill="none"/><text fill="#323232" font-size="15" x="42" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(413 71.625)">Target</text><text fill="#323232" font-size="15" x="42" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(413 103.625)">request()</text><path d="M586 70q0-4 4-4h150q4 0 4 4v56q0 4-4 4H590q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#9cf"/><path d="M586 96h158" stroke="#323232" stroke-width="2" fill="none"/><path d="M586 66h158v64H586z" fill="none"/><text fill="#323232" font-size="15" x="68" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(596 71.625)">Adaptee</text><text fill="#323232" font-size="15" x="68" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(596 103.625)">specificRequest()</text><g><path d="M472 231q0-4 4-4h161q4 0 4 4v60q0 4-4 4H476q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M472 257h169" stroke="#323232" stroke-width="2" fill="none"/><path d="M472 227h169v68H472z" fill="none"/><text fill="#323232" font-size="15" x="73.5" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(482 232.625)">Adapter</text><text fill="#323232" font-size="15" x="73.5" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(482 266.625)">request()</text></g><g><path d="M556.5 227v-48.5H456v-33.264" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#a)"/></g><g><path d="M556.5 227v-48.5H665v-33.264" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#b)"/></g><g><path d="M235.84 71.637q0-4 4-4h85q4 0 4 4v37q0 4-4 4h-85q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#f5927b"/><text fill="#323232" font-size="15" x="35.5" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(245.84 80.762)">Client</text></g><g><path d="M328.84 90.137h37.08V90h21.844" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#c)"/></g><g><path d="M716.364 254.654h125.818l16 16v24.455H716.364v-40.456z" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M842.182 254.654v16h16" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M716.364 254.654h125.818l16 16v24.455H716.364v-40.456z" stroke="#323232" stroke-width="2" fill="none"/><text fill="#323232" font-size="13" x="59.909" y="13.325" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(726.364 266.757)">specificRequest()</text></g><g><path d="M607.687 278.182h108.98" stroke="#323232" stroke-width="2" fill="none" marker-start="url(#d)"/></g></svg>
{%endraw%}

对象匹配器依赖于对象组合：
{%raw%}
<svg xmlns="http://www.w3.org/2000/svg" viewBox="215.840909090909 46.0 569.4532085561497 295.17647058823513" width="100%" height="100%"><defs><marker id="a" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1" refY="3.899"><path d="M12 3.9L0 7.797V0z" stroke="#323232" stroke-width="2" fill="#fff"/></marker><marker id="b" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1" refY="3.899"><path d="M12 3.9L0 7.797V0z" stroke="#323232" stroke-width="2" fill="#323232"/></marker><marker id="c" markerUnits="userSpaceOnUse" orient="auto" markerWidth="10" markerHeight="10" viewBox="-1.0 -1.0 10.0 10.0" refX="8" refY="4"><path d="M0 4a4 4 0 0 1 4-4 4 4 0 1 1-4 4" stroke="#323232" stroke-width="2" fill="#fff"/></marker><marker id="d" markerUnits="userSpaceOnUse" orient="auto" markerWidth="20.61" markerHeight="10.888" viewBox="-2.3047648709624866 -1.5914908829822711 20.609529741924973 10.888175666885001" refX="16" refY="3.853"><path d="M0 3.853L8 0l8 3.853-8 3.852z" stroke="#323232" stroke-width="2" fill="#fff"/></marker><marker id="e" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1" refY="3.899"><path d="M12 3.9L0 7.797V0z" stroke="#323232" stroke-width="2" fill="#323232"/></marker></defs><path d="M215.84 46h569.454v295.176H215.84V46z" fill="none"/><path d="M403 70q0-4 4-4h98q4 0 4 4v56q0 4-4 4h-98q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#9cf"/><path d="M403 96h106" stroke="#323232" stroke-width="2" fill="none"/><path d="M403 66h106v64H403z" fill="none"/><text fill="#323232" font-size="15" x="42" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(413 71.625)">Target</text><text fill="#323232" font-size="15" x="42" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(413 103.625)">request()</text><path d="M578.94 168.235q0-4 4-4h150q4 0 4 4v56q0 4-4 4h-150q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#9cf"/><path d="M578.94 194.235h158" stroke="#323232" stroke-width="2" fill="none"/><path d="M578.94 164.235h158v64h-158z" fill="none"/><text fill="#323232" font-size="15" x="68" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(588.94 169.86)">Adaptee</text><text fill="#323232" font-size="15" x="68" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(588.94 201.86)">specificRequest()</text><g><path d="M455.912 227.12v-48.56H456v-33.324" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#a)"/></g><g><path d="M235.84 71.637q0-4 4-4h85q4 0 4 4v37q0 4-4 4h-85q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#f5927b"/><text fill="#323232" font-size="15" x="35.5" y="15.375" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(245.84 80.762)">Client</text></g><g><path d="M328.84 90.137h37.08V90h21.844" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#b)"/></g><g><path d="M578.128 286.42h171.166l16 16v18.756H578.128V286.42z" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M749.294 286.42v16h16" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M578.128 286.42h171.166l16 16v18.756H578.128V286.42z" stroke="#323232" stroke-width="2" fill="none"/><text fill="#323232" font-size="13" x="82.583" y="13.325" font-family="Arial" text-anchor="middle" transform="translate(588.128 295.673)">adaptee.specificRequest()</text></g><g><path d="M391.47 230.176q0-4 4-4H516q4 0 4 4v82.883q0 4-4 4H395.47q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M391.47 256.176H520m-128.53 32H520" stroke="#323232" stroke-width="2" fill="none"/><path d="M391.47 226.176H520v90.883H391.47z" fill="none"/><text fill="#323232" font-size="13" x="53.265" y="13.325" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(401.47 233.05)">Adapter</text><text fill="#323232" font-size="13" x="53.265" y="13.325" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(401.47 263.05)">adaptee</text><text fill="#323232" font-size="13" x="53.265" y="13.325" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(401.47 295.05)">request()</text></g><g><path d="M505.334 304.064H577.647" stroke="#323232" stroke-width="2" fill="none" marker-start="url(#c)"/></g><g><path d="M538.305 271.618h11.166v-75.383h14.235" stroke="#323232" stroke-width="2" fill="none" marker-start="url(#d)" marker-end="url(#e)"/></g></svg>
{%endraw%}

## 参与者
- Target: 定义Client使用的与特定领域相关的接口
- Client: 与符合 Target 接口的对象协同
- Adaptee: 定义一个已经存在的接口，这个接口需要适配
- Adapter: 对Adaptee 的接口与 Target 接口进行适配

## 效果
类适配器和对象适配器有不同的权衡，其中类适配器：
- 用一个具体的Adapter类对Adaptee和Target进行匹配，结果是当我们想要匹配一个类以及它的所有子类时，类Adapter将不能胜任工作。
- 使得Adapter可以重定义Adaptee的部分行为，因为Adapter是Adaptee的一个子类
- 仅仅引入了一个对象，并不需要额外的指针以间接得到adaptee

对象适配器：
- 允许一个Adapter与多个Adaptee（Adaptee以及其子类）一同工作。Adapter也可以一次给所有的Adaptee添加功能
- 使得重定义Adaptee的行为比较困难。这就需要生成Adaptee的子类并且使得Adapter引用这个子类而不是引用Adaptee本身 (作为参数传递)

使用适配器模式需要考虑的因素：
- **Adapter的匹配程度**。 对Adaptee的接口与Target的接口进行匹配的工作量，各个Adapter可能不一样。可能从简单的接口转换到支持完全不同操作集合
- **可插入Adapter**。 当其他类使用一个类时，所需的假定条件越少，就具有越高的可复用性。
- **使用双向适配器提供透明操作**。 被适配的对象不再兼容Adaptee的接口，因此并不是所有Adaptee对象可以被使用的地方它都可以被使用，双向适配器可以提供这样的透明性（接口）。

## 实现
`Shape` 根据相对的两个角定义一个边框，而`TextView` 根据原点、宽度和高度定义一个边框。
```java
public interface Shape {
    void boundingBox (Point bottomLeft, Point topRight);
    Manipulator createManipulator ();
}
public interface TextView {
    void getOrigin(Coord x, Coord y);
    void getExtent (Coord width, Coord height);
    boolean isEmpty();
}
```

对象适配器采用对象组合的方法将具有不同接口的类组合在一起，适配器中维护了一个指向`TextView`的指针
```java
public class TextShapeAdapter implements Shape, TextView {

    private TextView textView;
    public TextShapeAdapter(TextView textView) {
        this.textView = textView;
    }
    @Override
    public void boundingBox(Point bottomLeft, Point topRight) {
        Coord bottom = new Coord(), left= new Coord(), width= new Coord(), height= new Coord();
        getOrigin(bottom, left);
        getExtent(width, height);
        bottomLeft.setBottom(bottom.getCenter());
        bottomLeft.setLeft(left.getCenter());
        topRight.setBottom(height.getCenter() + bottom.getCenter());
        topRight.setLeft(left.getCenter() + width.getCenter());
    }
    @Override
    public Manipulator createManipulator() {
        return null;
    }
    @Override
    public void getOrigin(Coord x, Coord y) {
    }
    @Override
    public void getExtent(Coord width, Coord height) {
    }
    @Override
    public boolean isEmpty() {
        return textView.isEmpty();
    }
}
```

## 相关模式
1. 模式Bridge的结构与对象适配器类似，但是Bridge的目的是将接口部分与实现部分分离，从而对他们可以较容易也相对独立的加以改变
2. Decorator模式增强了其他对象的功能而同时又不改变他们的接口，而且其支持递归组合。
3. Proxy在不改变它的接口的条件下，为另一个对象定义了一个代理。


# 分离抽象和实现 -- Bridge
将抽象部分与它的实现部分分离，使它们都可以独立地变化。
继承机制将抽象部分与它的实现部分固定在一起，是的难以对抽象部分和实现部分独立地进行修改、扩充和重用。

## 适用性
以下情况使用Bridge：
1. 不希望抽象和它的实现部分之间有固定的绑定关系，例如：在程序运行时刻实现部分应该可以被选择或者切换。
2. 类的抽象以及他的实现都应该可以通过生成子类的方法加以扩充。
3. 对一个抽象的实现部分的修改应该对客户不产生影响，即客户的代码不需要重新编译
4. 想在多个对象间共享实现，但同时要求客户并不知道这一点

## 结构

{% raw %}
<svg xmlns="http://www.w3.org/2000/svg" viewBox="71 61 850.25 301"><defs><marker id="a" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#fff" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker><marker id="b" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#fff" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker><marker id="c" markerUnits="userSpaceOnUse" orient="auto" markerWidth="20.61" markerHeight="10.888" viewBox="-2.305 -1.591 20.61 10.888" refX="16" refY="3.853"><path fill="#fff" stroke="#323232" stroke-width="2" d="M0 3.853L8 0l8 3.853-8 3.852z"/></marker><marker id="d" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#323232" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker><marker id="e" markerUnits="userSpaceOnUse" orient="auto" markerWidth="10" markerHeight="10" viewBox="-1 -1 10 10" refX="8" refY="4"><path fill="#fff" stroke="#323232" stroke-width="2" d="M0 4a4 4 0 0 1 4-4 4 4 0 1 1-4 4"/></marker><marker id="f" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#fff" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker><marker id="g" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#323232" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker></defs><path fill="none" d="M71 61h850.25v301H71V61z"/><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M177 284h164v39H177z"/><text x="71" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" text-anchor="middle" transform="translate(187 294.125)">RefinedAbstraction</text><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M191 120q0-4 4-4h128q4 0 4 4v51q0 4-4 4H195q-4 0-4-4z"/><path fill="none" stroke="#323232" stroke-width="2" d="M191 146h136"/><path fill="none" d="M191 116h136v59H191z"/><text x="57" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(201 121.625)">Abstraction</text><text x="57" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(201 151.125)">operation()</text><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M584.5 119.5q0-4 4-4h128q4 0 4 4v52q0 4-4 4h-128q-4 0-4-4z"/><path fill="none" stroke="#323232" stroke-width="2" d="M584.5 145.5h136"/><path fill="none" d="M584.5 115.5h136v60h-136z"/><text x="57" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(594.5 121.125)">Implementor</text><text x="57" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(594.5 151.125)">operationImp()</text><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M315 201h147l16 16v26H315v-42z"/><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M462 201v16h16"/><path fill="none" stroke="#323232" stroke-width="2" d="M315 201h147l16 16v26H315v-42z"/><text x="70.5" y="14.35" fill="#323232" font-size="14" font-family="微软雅黑" text-anchor="middle" transform="translate(325 213.25)">imp.operationImp();</text><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M407.5 278q0-4 4-4H614q4 0 4 4v60q0 4-4 4H411.5q-4 0-4-4z"/><path fill="none" stroke="#323232" stroke-width="2" d="M407.5 312H618"/><path fill="none" d="M407.5 274H618v68H407.5z"/><text x="94.25" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(417.5 283.625)">ConcreteImplementorA</text><text x="94.25" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(417.5 317.625)">operationImp()</text><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M686.25 278q0-4 4-4h207q4 0 4 4v60q0 4-4 4h-207q-4 0-4-4z"/><path fill="none" stroke="#323232" stroke-width="2" d="M686.25 304h215"/><path fill="none" d="M686.25 274h215v68h-215z"/><text x="96.5" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(696.25 279.625)">ConcreteImplementorB</text><text x="96.5" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(696.25 313.625)">operationImp()</text><path fill="none" stroke="#323232" stroke-width="2" d="M793.75 274v-49.25H652.5v-34.014" marker-end="url(#a)"/><path fill="none" stroke="#323232" stroke-width="2" d="M512.75 274v-49.25H652.5v-34.014" marker-end="url(#b)"/><path fill="none" stroke="#323232" stroke-width="2" d="M345.305 145.5h223.96" marker-start="url(#c)" marker-end="url(#d)"/><path fill="none" stroke="#323232" stroke-width="2" d="M305 170v51.5h17v.5" marker-start="url(#e)"/><path fill="none" stroke="#323232" stroke-width="2" d="M259 284v-93.764" marker-end="url(#f)"/><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M91 85q0-4 4-4h60q4 0 4 4v26.5q0 4-4 4H95q-4 0-4-4z"/><text x="23" y="15.375" fill="#323232" font-size="15" font-family="Arial" font-weight="bold" text-anchor="middle" transform="translate(101 88.875)">Client</text><path fill="none" stroke="#323232" stroke-width="2" d="M125 115.5v30h50.764" marker-end="url(#g)"/></svg>
{%endraw%}

## 参与者
- `Abstraction`: 定义抽象接口的类；维护一个指向`Implementor`类型对象的指针
- `RefinedAbstraction`: 扩充`Abstraction` 定义的接口
- `Implementor`: 定义实现类的接口，该接口不一定要与`Abstraction`接口完全一致；一般来讲，`Implementor`接口仅提供基本操作，而`Abstraction`则定义了基于这些操作的较高层次的操作
- `ConcreteImplementor`: 实现`Implementor`接口并定义了它的具体实现。

## 效果
Bridge模式有以下优点：
1. **分离接口及其实现部分**。一个实现未必不变地绑定在一个接口上。抽象类的实现可以在运行时刻进行配置，一个对象甚至可以在运行时刻改变它的实现。将`Abstraction`与`Implementor`分离有助于降低对实现部分编译时刻的依赖，当改变实现类时，并不需要重新编译`Abstraction`类和它的客户程序。为了保证一个类库的不同版本之间的兼容性，一定要有这个性质
2. **提高可扩充性**。可以独立地对`Abstraction`与`Implementor`进行扩充
3. **实现细节对客户透明**。
4. **Bridge模式要求正确识别出系统中两个独立变化的维度**。因此其使用范围具有一定的局限性。

## 实现
1. **仅有一个Implementor。在仅有一个实现时，没必要创建一个抽象的Implementor，这是Bridge退化的情况**。这时，Abstraction和Implementor是一一对应的，但是当改变一个类的实现不会影响已有的客户程序，模式分离的机制还是有用的
2. **创建正确的Implementor对象**。当Abstraction知道所有的ConcreteImplementor类，它就可以在构造器中对其中的一个类进行实例化，可以通过传递参数给构造器确定实例化哪个类；还可以选择一个缺省实现，然后根据需要改变这个实现；还可以代理给一个对象，由它决定，比如Abstract Factory。
3. **共享Implementor对象**。

## 相关模式
Abstract Factory模式可以用来创建和配置一个特定的Bridge模式
Adapter模式用来 帮助无关的类协同工作，它通常在系统设计完成后才会被使用。然而，Bridge模式则是在系统开始时使用，它使得抽象接口和实现部分可以独立进行改变。

# 部分整体递归组合 —— Composite
将对象组合成树形结构以表示 “部分-整体”的层次结构。Composite使得用户对单个对象和组合对象的使用具有一致性。

## 适用性
以下情况适用于Composite模式：
1. 想表示对象的部分-整体层次结构
2. 希望用户忽略组合对象与单个对象的不同，用户将统一地使用组合结构中的所有对象

## 结构

{%raw%}
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="processonSvg1000" viewBox="48.62962962962963 58.518518518518505 670.3703703703703 349.4814814814815" width="100%" height="100%"><defs id="ProcessOnDefs1001"><marker id="ProcessOnMarker1037" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1038" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#fff" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1041" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1042" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#fff" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1045" markerUnits="userSpaceOnUse" orient="auto" markerWidth="20.609529741924973" markerHeight="10.888175666885001" viewBox="-2.3047648709624866 -1.5914908829822711 20.609529741924973 10.888175666885001" refX="16.0" refY="3.8525969504602293"><path id="ProcessOnPath1046" d="M0 3.8525969504602293L8.0 0L16.0 3.8525969504602293L8.0 7.705193900920459Z" stroke="#323232" stroke-width="2.0" fill="#fff"/></marker><marker id="ProcessOnMarker1047" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1048" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1062" markerUnits="userSpaceOnUse" orient="auto" markerWidth="10.0" markerHeight="10.0" viewBox="-1.0 -1.0 10.0 10.0" refX="8.0" refY="4.0"><path id="ProcessOnPath1063" d="M0 4.0A4.0 4.0 0 0 1 4.0 0A4.0 4.0 0 1 1 0 4.0" stroke="#323232" stroke-width="2.0" fill="#fff"/></marker><marker id="ProcessOnMarker1070" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1071" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker></defs><g id="ProcessOnG1002"><path id="ProcessOnPath1003" d="M48.62962962962963 58.518518518518505H719.0V408.0H48.629629629629676V58.518518518518476Z" fill="none"/><g id="ProcessOnG1004"><g id="ProcessOnG1005" transform="matrix(1.0,0.0,0.0,1.0,203.37037037037038,84.05212620027436)" opacity="1.0"><path id="ProcessOnPath1006" d="M0.0 4.0Q0.0 0.0 4.0 0.0L179.0 0.0Q183.0 0.0 183.0 4.0L183.0 117.0Q183.0 121.0 179.0 121.0L4.0 121.0Q0.0 121.0 0.0 117.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1007" d="M0.0 30.0L183.0 30.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1008" d="M0.0 0.0L183.0 0.0L183.0 121.0L0.0 121.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1009" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1010" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">          Component</text></g><g id="ProcessOnG1011" transform="matrix(1.0,0.0,0.0,1.0,10.0,38.0)"><text id="ProcessOnText1012" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">operation()</text><text id="ProcessOnText1013" fill="#323232" font-size="15" x="0.0" y="34.125" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">add(Component c)</text><text id="ProcessOnText1014" fill="#323232" font-size="15" x="0.0" y="52.875" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">remove(Component c)</text><text id="ProcessOnText1015" fill="#323232" font-size="15" x="0.0" y="71.625" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">getChild(int i)</text></g></g><g id="ProcessOnG1016" transform="matrix(1.0,0.0,0.0,1.0,138.0,264.0)" opacity="1.0"><path id="ProcessOnPath1017" d="M0.0 4.0Q0.0 0.0 4.0 0.0L114.0 0.0Q118.0 0.0 118.0 4.0L118.0 58.0Q118.0 62.0 114.0 62.0L4.0 62.0Q0.0 62.0 0.0 58.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1018" d="M0.0 30.0L118.0 30.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1019" d="M0.0 0.0L118.0 0.0L118.0 62.0L0.0 62.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1020" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1021" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">       Leaf</text></g><g id="ProcessOnG1022" transform="matrix(1.0,0.0,0.0,1.0,10.0,36.625)"><text id="ProcessOnText1023" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">operation()</text></g></g><g id="ProcessOnG1024" transform="matrix(1.0,0.0,0.0,1.0,306.5,264.0)" opacity="1.0"><path id="ProcessOnPath1025" d="M0.0 4.0Q0.0 0.0 4.0 0.0L186.0 0.0Q190.0 0.0 190.0 4.0L190.0 120.0Q190.0 124.0 186.0 124.0L4.0 124.0Q0.0 124.0 0.0 120.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1026" d="M0.0 30.0L190.0 30.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1027" d="M0.0 0.0L190.0 0.0L190.0 124.0L0.0 124.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1028" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1029" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">            Composite</text></g><g id="ProcessOnG1030" transform="matrix(1.0,0.0,0.0,1.0,10.0,39.5)"><text id="ProcessOnText1031" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">operation()</text><text id="ProcessOnText1032" fill="#323232" font-size="15" x="0.0" y="34.125" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">add(Component c)</text><text id="ProcessOnText1033" fill="#323232" font-size="15" x="0.0" y="52.875" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">remove(Component c)</text><text id="ProcessOnText1034" fill="#323232" font-size="15" x="0.0" y="71.625" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">getChild(int i)</text></g></g><g id="ProcessOnG1035"><path id="ProcessOnPath1036" d="M401.5 264.0L401.5 234.52606310013715L294.8703703703704 234.52606310013715L294.8703703703704 220.28819417777413" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1037)"/></g><g id="ProcessOnG1039"><path id="ProcessOnPath1040" d="M197.0 264.0L197.0 234.52606310013715L294.8703703703704 234.52606310013715L294.8703703703704 220.28819417777413" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1041)"/></g><g id="ProcessOnG1043"><path id="ProcessOnPath1044" d="M514.3047648709625 286.0L582.1538461538457 286.0L582.1538461538457 102.59244878091951L401.60643834787015 102.59244878091951" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1045)" marker-end="url(#ProcessOnMarker1047)"/></g><g id="ProcessOnG1049" transform="matrix(1.0,0.0,0.0,1.0,68.62962962962963,78.5185185185185)" opacity="1.0"><path id="ProcessOnPath1050" d="M0.0 4.0Q0.0 0.0 4.0 0.0L70.0 0.0Q74.0 0.0 74.0 4.0L74.0 37.0Q74.0 41.0 70.0 41.0L4.0 41.0Q0.0 41.0 0.0 37.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><g id="ProcessOnG1051" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.125)"><text id="ProcessOnText1052" fill="#323232" font-size="15" x="26.0" y="15.375" font-family="Arial" font-weight="bold" font-style="normal" text-decoration="none" family="Arial" text-anchor="middle" size="15">Client</text></g></g><g id="ProcessOnG1053" transform="matrix(1.0,0.0,0.0,1.0,559.0,296.0)" opacity="1.0"><path id="ProcessOnPath1054" d="M0.0 0.0L124.0 0.0L140.0 16.0L140.0 54.0L0.0 54.0L0.0 0.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1055" d="M124.0 0.0L124.0 16.0L140.0 16.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1056" d="M0.0 0.0L124.0 0.0L140.0 16.0L140.0 54.0L0.0 54.0L0.0 0.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1057" transform="matrix(1.0,0.0,0.0,1.0,10.0,8.25)"><text id="ProcessOnText1058" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="Arial" font-weight="normal" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">for g in children</text><text id="ProcessOnText1059" fill="#323232" font-size="15" x="0.0" y="34.125" font-family="Arial" font-weight="normal" font-style="normal" text-decoration="none" family="Arial" text-anchor="start" size="15">    g.operation()</text></g></g><g id="ProcessOnG1060"><path id="ProcessOnPath1061" d="M451.0 311.0L500.5 311.0L500.5 311.0L559.0 311.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="2.0 3.0" fill="none" marker-start="url(#ProcessOnMarker1062)"/></g><g id="ProcessOnG1064" transform="matrix(1.0,0.0,0.0,1.0,453.0,247.0)" opacity="1.0"><path id="ProcessOnPath1065" d="M0.0 0.0L160.0 0.0L160.0 40.0L0.0 40.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1066" transform="matrix(1.0,0.0,0.0,1.0,0.0,10.625)"><text id="ProcessOnText1067" fill="#323232" font-size="15" x="79.0" y="15.375" font-family="Arial" font-weight="normal" font-style="normal" text-decoration="none" family="Arial" text-anchor="middle" size="15">children</text></g></g><g id="ProcessOnG1068"><path id="ProcessOnPath1069" d="M142.62962962962962 99.0185185185185L173.0 99.0185185185185L173.0 99.05212620027436L188.13430239287058 99.05212620027436" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1070)"/></g></g></g></svg>
{%endraw%}

## 参与者
- `Component`: 为组合中的对象声明接口；在适当的情况下，实现所有类共有接口的缺省行为；声明一个接口用于访问和管理Component的子组件；在递归结构中定义一个接口，用于访问一个父部件
- `Leaf`: 在组合 中表示叶节点对象，叶节点没有子节点；在组合中定义图元对象的行为
- `Composite`: 定义有子部件的那些部件的行为；存储子部件；在Component接口中实现与子部件有关的操作

## 协作
用户使用`Component`类接口与组合结构中的对象进行交互。不可接受接收者是一个叶节点，则直接处理请求。如果接收者是`Composite`，它通常将请求发送给它的子部件，在转发请求之前或之后可以执行一些辅助操作。

## 效果
Composite模式的效果如下：
- **定义了包含基本对象和组合对象的类层次结构**
- **客户可以一致地使用组合结构和单个对象**
- **使得更容易增加新类型的组件**。新定义的Composite或Leaf子类自动地与已有的结构和客户代码一起工作，客户程序不需要因新的Component类而改变
- **使你的设计更加一般化**。容易增加新组件也会产生一些问题，那就是很难限制组合中的组件。如果希望一个组合只能有某些特定的组件，不能依赖类型系统施加这些约束，而必须在运行时刻进行检查

## 实现
我们在实现Composite模式进需要考虑以下问题：
1. **显式的父部件的引用**。保持从子部件到父部件的引用能简化组合结构的遍历和管理。父部件引用可以简化结构的上移和组件的删除。
2. **共享组件**。共享组件是比较有用的，比如它可买减少对存储空间的需求，但是当一个组件只用一个父部件时，很难共享组件
3. **最大化Component接口**。Composite模式的目的之一是使得用户不知道他们正在使用的具体的Leaf和Composite类。因此，Composite类应为Leaf和Composite类尽可能多定义一些公共操作。Composite类通常为这些操作提供缺省的实现。
4. **在什么地方声明管理子部件的操作**。我们是应该在Component中声明这些操作，并使这些操作对Leaf类有意义，还是只应该在Composite和它的子类中声明这些操作？这需要在安全性和透明性之间做出权衡选择：
    - 类层次结构的根部，即在Components中定义节点管理接口的方法具有良好的透明性，但是会牺牲安全性。因为客户有可能会做一些无意义的操作
    - 在Composite类中定义具有良好的安全性，但是Leaf和Composite具有不同的接口

## 代码
计算机和立体声组合音响这样的设备经常被组装成部分-整体层次结构或者是容器层次结构。例如，底盘可包含驱动装置和平面板，总线含有多个插件，机柜包括底盘、总线等。这种结构很自然地用Composite模式进行模拟。
```java
/**
 * Equipment为 部分-整体 层次结构中的所有设备定义一个接口
 */
public abstract class EquipmentComponent {
    private String name;

    EquipmentComponent(String name) {
        this.name = name;
    }
    public String getName() {return name;}
    public abstract int netPrice();
    public abstract int discountPrice();

    public abstract void add(EquipmentComponent e);
    public abstract void remove(EquipmentComponent e);
    public abstract Iterator<EquipmentComponent> createIterator();
}
```

`EquipmentComposite` 是包含其他设备的基类，也是 `EquipmentComponent` 的子类
```java
public abstract class EquipmentComposite extends EquipmentComponent {
    private List<EquipmentComponent> equipments;
    public EquipmentComposite (String name){
        super(name);
    }

    @Override
    public Iterator<EquipmentComponent> createIterator() {
        return equipments.iterator();
    }

    @Override
    public int netPrice() {
        Iterator<EquipmentComponent> it = createIterator();
        int total = 0;
        while(it.hasNext()) {
            total += it.next().netPrice();
        }
        return total;
    }

    @Override
    public void add(EquipmentComponent e) {
        equipments.add(e);
    }
    @Override
    public void remove(EquipmentComponent e) {
        equipments.remove(e);
    }
}
```

还有 Leaf 类：
```java
public class FloppyDiskLeaf extends EquipmentComponent {
    FloppyDiskLeaf(String name) {
        super(name);
    }
    @Override
    public int netPrice() { return 0; }
    @Override
    public int discountPrice() { return 0; }
    @Override
    public void add(EquipmentComponent e) { }
    @Override
    public void remove(EquipmentComponent e) {  }
    @Override
    public Iterator<EquipmentComponent> createIterator() {return null;}
}
```

## 相关模式
1. Decorator模式经常与Composite模式一起使用，它们通常有一个公共的父类。
2. Flyweight 让你共享组件，但不能引用它们的父部件 
3. Itertor 用来遍历 Composite
4. Visitor 将本来应该分布在Composite和Leaf类中的扣件和行为局部化

# 动态修改对象职责 -- Decorator
动态地给一个对象添加一些额外的职责。就增加功能来说，Decorator模式相比生成子类更为灵活。

## 适用性
以下情况使用Decorator模式：
1. 不影响其他对象的情况下，以动态、透明的方式给单个对象添加职责
2. 处理那些可以撤消的职责
3. 当不能采用生成子类的方法进行扩充时。可能有大量独立的扩展，为支持每一种组合将产生大量的子类，使得子类数目呈爆炸性增长。另一种情况可能是因为类定义被隐藏，或类定义不能用于生成子类。

## 结构
{%raw%}
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="processonSvg1000" viewBox="81.0 64.05212620027436 730.5 449.94787379972564" width="100%" height="100%"><defs id="ProcessOnDefs1001"><marker id="ProcessOnMarker1031" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1032" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#fff" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1035" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1036" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#fff" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1039" markerUnits="userSpaceOnUse" orient="auto" markerWidth="20.609529741924973" markerHeight="10.888175666885001" viewBox="-2.3047648709624866 -1.5914908829822711 20.609529741924973 10.888175666885001" refX="16.0" refY="3.8525969504602293"><path id="ProcessOnPath1040" d="M0 3.8525969504602293L8.0 0L16.0 3.8525969504602293L8.0 7.705193900920459Z" stroke="#323232" stroke-width="2.0" fill="#fff"/></marker><marker id="ProcessOnMarker1041" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1042" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1051" markerUnits="userSpaceOnUse" orient="auto" markerWidth="10.0" markerHeight="10.0" viewBox="-1.0 -1.0 10.0 10.0" refX="8.0" refY="4.0"><path id="ProcessOnPath1052" d="M0 4.0A4.0 4.0 0 0 1 4.0 0A4.0 4.0 0 1 1 0 4.0" stroke="#323232" stroke-width="2.0" fill="#fff"/></marker><marker id="ProcessOnMarker1078" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1079" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#fff" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1082" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1083" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#fff" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1093" markerUnits="userSpaceOnUse" orient="auto" markerWidth="10.0" markerHeight="10.0" viewBox="-1.0 -1.0 10.0 10.0" refX="8.0" refY="4.0"><path id="ProcessOnPath1094" d="M0 4.0A4.0 4.0 0 0 1 4.0 0A4.0 4.0 0 1 1 0 4.0" stroke="#323232" stroke-width="2.0" fill="#fff"/></marker></defs><g id="ProcessOnG1002"><path id="ProcessOnPath1003" d="M81.0 64.05212620027436H811.5V514.0H81.0V64.05212620027436Z" fill="none"/><g id="ProcessOnG1004"><g id="ProcessOnG1005" transform="matrix(1.0,0.0,0.0,1.0,203.37037037037038,84.05212620027436)" opacity="1.0"><path id="ProcessOnPath1006" d="M0.0 4.0Q0.0 0.0 4.0 0.0L136.62962962962962 0.0Q140.62962962962962 0.0 140.62962962962962 4.0L140.62962962962962 56.0Q140.62962962962962 60.0 136.62962962962962 60.0L4.0 60.0Q0.0 60.0 0.0 56.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1007" d="M0.0 30.0L140.62962962962962 30.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1008" d="M0.0 0.0L140.62962962962962 0.0L140.62962962962962 60.0L0.0 60.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1009" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1010" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">Component</text></g><g id="ProcessOnG1011" transform="matrix(1.0,0.0,0.0,1.0,10.0,35.625)"><text id="ProcessOnText1012" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">operation()</text></g></g><g id="ProcessOnG1013" transform="matrix(1.0,0.0,0.0,1.0,101.0,264.0)" opacity="1.0"><path id="ProcessOnPath1014" d="M0.0 4.0Q0.0 0.0 4.0 0.0L178.0 0.0Q182.0 0.0 182.0 4.0L182.0 67.0Q182.0 71.0 178.0 71.0L4.0 71.0Q0.0 71.0 0.0 67.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1015" d="M0.0 38.0L182.0 38.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1016" d="M0.0 0.0L182.0 0.0L182.0 71.0L0.0 71.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1017" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.625)"><text id="ProcessOnText1018" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">ConcreteComponent</text></g><g id="ProcessOnG1019" transform="matrix(1.0,0.0,0.0,1.0,10.0,45.125)"><text id="ProcessOnText1020" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">operation()</text></g></g><g id="ProcessOnG1021" transform="matrix(1.0,0.0,0.0,1.0,337.5,264.0)" opacity="1.0"><path id="ProcessOnPath1022" d="M0.0 4.0Q0.0 0.0 4.0 0.0L118.5 0.0Q122.5 0.0 122.5 4.0L122.5 58.0Q122.5 62.0 118.5 62.0L4.0 62.0Q0.0 62.0 0.0 58.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1023" d="M0.0 30.0L122.5 30.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1024" d="M0.0 0.0L122.5 0.0L122.5 62.0L0.0 62.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1025" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1026" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">Decorator</text></g><g id="ProcessOnG1027" transform="matrix(1.0,0.0,0.0,1.0,10.0,36.625)"><text id="ProcessOnText1028" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">operation()</text></g></g><g id="ProcessOnG1029"><path id="ProcessOnPath1030" d="M398.75 264.0L398.75 204.02606310013718L273.6851851851852 204.02606310013718L273.6851851851852 159.28819417777416" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1031)"/></g><g id="ProcessOnG1033"><path id="ProcessOnPath1034" d="M192.0 264.0L192.0 204.02606310013718L273.6851851851852 204.02606310013718L273.6851851851852 159.28819417777416" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1035)"/></g><g id="ProcessOnG1037"><path id="ProcessOnPath1038" d="M477.98239644990986 286.73333333333335L601.6776315789474 286.73333333333335L601.6776315789474 108.5765761368931L359.2360679774998 108.5765761368931" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1039)" marker-end="url(#ProcessOnMarker1041)"/></g><g id="ProcessOnG1043" transform="matrix(1.0,0.0,0.0,1.0,559.0,296.0)" opacity="1.0"><path id="ProcessOnPath1044" d="M0.0 0.0L196.0 0.0L212.0 16.0L212.0 42.0L0.0 42.0L0.0 0.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1045" d="M196.0 0.0L196.0 16.0L212.0 16.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1046" d="M0.0 0.0L196.0 0.0L212.0 16.0L212.0 42.0L0.0 42.0L0.0 0.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1047" transform="matrix(1.0,0.0,0.0,1.0,10.0,11.625)"><text id="ProcessOnText1048" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">component.operation()</text></g></g><g id="ProcessOnG1049"><path id="ProcessOnPath1050" d="M451.0 311.0L500.5 311.0L500.5 311.0L559.0 311.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="2.0 3.0" fill="none" marker-start="url(#ProcessOnMarker1051)"/></g><g id="ProcessOnG1053" transform="matrix(1.0,0.0,0.0,1.0,490.0,248.0)" opacity="1.0"><path id="ProcessOnPath1054" d="M0.0 0.0L160.0 0.0L160.0 40.0L0.0 40.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1055" transform="matrix(1.0,0.0,0.0,1.0,0.0,10.625)"><text id="ProcessOnText1056" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">component</text></g></g><g id="ProcessOnG1057" transform="matrix(1.0,0.0,0.0,1.0,368.6851851851852,404.0)" opacity="1.0"><path id="ProcessOnPath1058" d="M0.0 4.0Q0.0 0.0 4.0 0.0L186.31481481481478 0.0Q190.31481481481478 0.0 190.31481481481478 4.0L190.31481481481478 86.0Q190.31481481481478 90.0 186.31481481481478 90.0L4.0 90.0Q0.0 90.0 0.0 86.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1059" d="M0.0 30.0L190.31481481481478 30.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1060" d="M0.0 0.0L190.31481481481478 0.0L190.31481481481478 90.0L0.0 90.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1061" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1062" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">ConcreteDecoratorA</text></g><g id="ProcessOnG1063" transform="matrix(1.0,0.0,0.0,1.0,10.0,41.25)"><text id="ProcessOnText1064" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">operation()</text><text id="ProcessOnText1065" fill="#323232" font-size="15" x="0.0" y="34.125" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">addedBehavior()</text></g></g><g id="ProcessOnG1066" transform="matrix(1.0,0.0,0.0,1.0,137.0,404.0)" opacity="1.0"><path id="ProcessOnPath1067" d="M0.0 4.0Q0.0 0.0 4.0 0.0L177.0 0.0Q181.0 0.0 181.0 4.0L181.0 86.0Q181.0 90.0 177.0 90.0L4.0 90.0Q0.0 90.0 0.0 86.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1068" d="M0.0 30.0L181.0 30.0M0.0 62.0L181.0 62.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1069" d="M0.0 0.0L181.0 0.0L181.0 90.0L0.0 90.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1070" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1071" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">ConcreteDecoratorA</text></g><g id="ProcessOnG1072" transform="matrix(1.0,0.0,0.0,1.0,10.0,35.625)"><text id="ProcessOnText1073" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">addedState</text></g><g id="ProcessOnG1074" transform="matrix(1.0,0.0,0.0,1.0,10.0,67.625)"><text id="ProcessOnText1075" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">operation()</text></g></g><g id="ProcessOnG1076"><path id="ProcessOnPath1077" d="M227.5 404.0L227.5 365.0L398.75 365.0L398.75 341.2360679774998" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1078)"/></g><g id="ProcessOnG1080"><path id="ProcessOnPath1081" d="M463.8425925925926 404.0L463.8425925925926 365.0L398.75 365.0L398.75 341.2360679774998" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1082)"/></g><g id="ProcessOnG1084" transform="matrix(1.0,0.0,0.0,1.0,599.5,435.0)" opacity="1.0"><path id="ProcessOnPath1085" d="M0.0 0.0L176.0 0.0L192.0 16.0L192.0 44.0L0.0 44.0L0.0 0.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1086" d="M176.0 0.0L176.0 16.0L192.0 16.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1087" d="M0.0 0.0L176.0 0.0L192.0 16.0L192.0 44.0L0.0 44.0L0.0 0.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1088" transform="matrix(1.0,0.0,0.0,1.0,10.0,3.25)"><text id="ProcessOnText1089" fill="#323232" font-size="15" x="0.0" y="15.375" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">operation();</text><text id="ProcessOnText1090" fill="#323232" font-size="15" x="0.0" y="34.125" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="15">addedBehavior();</text></g></g><g id="ProcessOnG1091"><path id="ProcessOnPath1092" d="M492.0 454.0L541.5 454.0L541.5 454.0L600.0 454.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="2.0 3.0" fill="none" marker-start="url(#ProcessOnMarker1093)"/></g></g></g></svg>
{%endraw%}

## 参与者
- `Component`: 定义一个对象接口，可以给这些对象动态地添加职责
- `ConcreteComponent`: 定义一个对象，可以给这个对象添加一些职责
- `Decorator`: 维持一个指向`Component`对象的指针，并定义一个与`Component`接口一致的接口
- `ConcreteDecorator`: 向组件添加职责

`Decorator` 将请求转发给它的 `Component` 对象，并有可能在转发请求后执行一些附加动作

## 效果
Decorator模式主要有如下优点：
- **比静态继承更灵活**
- **避免在层次结构高层的类有太多的特征**。 定义一个简单的类，并且用Decorator类给它逐渐添加功能，这样可以从简单的部件组合出复杂的功能。

Decorator模式主要有如下缺点：
- **Decorator与它的Component不一样**。Decorator是一个透明的包装，如果我们从对象标识出发，一个被装饰了的组件与这个组件是有差别的，因此，使用装饰时不应该依赖对象标识
- **有许多小对象**。采用Decorator模式时，往往会产生许多看上去类似的小对象，这些对象仅仅在他们相互连接的方式上有所不同，而不是它们的类或是它们的属性值不同，造成这样的系统很难学习。

## 实现
实现Decorator模式时应该注意以下几点：
1. **接口的一致性**。装饰对象的接口必须与它所装饰的Component的接口是一致的，因此，所有的ConcreteDecorator类必须有一个公共的父类。
2. **省略抽象的Decorator类**。当仅需要一个职责时，可以把Decorator向Component转发请求的职责合并到ConcreteDecorator中
3. **保持Component类的简单性**。因为Component是公共父类，它应定义接口而不是存储数据。赋予Component太多的功能也使得，具体的子类有一些它们并不需要的功能的可能性大大增加。
4. **改变对象外壳与改变对象内核**。Decorator改变的是对象在外壳，Strategy模式改变的是对象在内核

## 代码示例
Component类如下：
```java
public abstract class VisualComponent {
    public VisualComponent(){}
    public abstract void draw();
    public abstract void resize();
}
```

将生成Decorator的子类以获取不同的装饰，Decorator装饰由`component`实例变量引用的VisualComponent，这个实例变量在构造器中被初始化：
```java
public class Decorator extends VisualComponent {
    private VisualComponent component;
    Decorator (VisualComponent component) {
        this.component = component;
    }
    @Override
    public void draw() {
        component.draw();
    }
    @Override
    public void resize() {
        component.resize();
    }
}
```

BorderDecorator类为它所包含的组件添加了一个边框。BorderDecorator是Decorator的子类，它重定义Draw操作用于绘制边框：
```java
public class BorderDecorator extends Decorator{
    private int borderWidth;
    public BorderDecorator(VisualComponent component, int borderWidth) {
        super(component);
        this.borderWidth = borderWidth;
    }
    @Override
    public void draw() {
        super.draw();
        drawBorder();
    }
    private void drawBorder(){}
}
```

可以用如下方式使用 Decorator：
```java
VisualComponent component = new BorderDecorator(new TextView(), 1);
```

## 相关模式
1. Adapter模式：适配器给对象一个全新的接口
2. Composite模式： 将装饰视为一个退化的、仅有一个组件的组合。然而，装饰仅给对象添加一些额外的职责，而不在于对象聚集
3. Strategy模式：用一个装饰你可以改变对象的外表；Strategy模式使得你可以改变对象的内核。

# 封装复杂子系统接口 —— Facade
为子系统中的一组接口提供一个一致的界面，Facade模式定义了一个高层接口，这个接口使得这一子系统更加容易使用。

## 适用性
以下情况适用于Facade模式
1. **为一个复杂系统提供一个简单接口**。Facade可以为一个复杂系统提供一个简单的缺省视图，这一视图对大多数用户来说已经足够，而那些需要更多功能的用户可以越过Facade层
2. **构建一个层次结构的子系统时，可以使用Facade模式定义子系统中每层的入口点**。
3. **提高子系统的独立性和可移植性**。

## 结构
{%raw%}
<svg xmlns="http://www.w3.org/2000/svg" width="100%" height="100%" viewBox="121 94 688 314"><defs><marker id="a" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#323232" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker><marker id="b" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#323232" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker><marker id="c" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#323232" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker><marker id="d" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#fff" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker><marker id="e" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#fff" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker><marker id="f" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.236" markerHeight="10.551" viewBox="-1 -1.376 16.236 10.551" refX="-1" refY="3.899"><path fill="#323232" stroke="#323232" stroke-width="2" d="M12 3.9L0 7.797V0z"/></marker></defs><path fill="none" d="M121 94h688v314H121V94z"/><path fill="none" stroke="#323232" stroke-width="2" d="M141 140h648v248H141z"/><text y="34.125" fill="#323232" font-size="15" font-family="微软雅黑" font-weight="bold" transform="translate(151 140)">子系统类</text><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M392 114h107v50H392z"/><text x="42.5" y="15.375" fill="#323232" font-size="15" font-family="微软雅黑" text-anchor="middle" transform="translate(402 129.625)">Facade</text><path fill="#f5927b" stroke="#323232" stroke-width="2" d="M289 205h83v29h-83zm55 65.5h83v29h-83zm-150 57h83v29h-83zm0-78h83v29h-83zm402-40h83v29h-83zm-63 99h83v29h-83zm124 0h83v29h-83z"/><path fill="none" stroke="#323232" stroke-width="2" d="M445.5 164v20.5h-115v5.264" marker-end="url(#a)"/><path fill="none" stroke="#323232" stroke-width="2" d="M445.5 164v53.5H393v38.264" marker-end="url(#b)"/><path fill="none" stroke="#323232" stroke-width="2" d="M445.5 164v178H292.236" marker-end="url(#c)"/><path fill="none" stroke="#323232" stroke-width="2" d="M235.5 327.5v-33.764" marker-end="url(#d)"/><path fill="none" stroke="#323232" stroke-width="2" d="M277 264h33.5v21H344m230.5 23.5v-35h63v-35"/><path fill="none" stroke="#323232" stroke-width="2" d="M698.5 308.5v-35h-61v-19.764" marker-end="url(#e)"/><path fill="none" stroke="#323232" stroke-width="2" d="M445.5 164v159h72.264" marker-end="url(#f)"/></svg>
{%endraw%}

## 参与者
- `Facade`: 知道哪些子系统类负责处理请求；将客户的请求代理给适当的子系统对象
- 子系统类： 实现子系统的功能；处理有Facade对象指派的任务；没有Facade的任何信息
 
## 协作
客户程序通过发送请求给Facade的方式与子系统通讯，Facade将这些消息转发给适当的子系统对象。Facade模式本身需要将它的接口转换成子系统的接口

## 效果
1. **屏蔽了子系统组件，减少了客户处理对象的数目并使子系统用起来更方便**
2. **实现了子系统与客户之间的松耦合关系，而子系统内部的功能组件往往是紧耦合的**

## 实现
1. **降低客户-子系统之间的耦合度**。 用抽象类实现Facade，而它的具体子类对应于不同的子系统实现，可以进一步降低客户与子系统的耦合度。
2. **公共子系统类与私有子系统类**。 子系统的公共接口包含所有的客户程序可以访问的类；私有接口仅用于对子系统进行扩充。Java中可以使用抽象类实现私有接口。

## 相关模式
1. Abstract Factory 模式可以与Facade模式一起使用以提供一个接口，这个接口可以用来以一种子系统独立的方式创建子系统对象，Abstract Factory也可以代替Facade模式隐藏那些与平台相关的类。
2. Mediator模式与Facade模式的相似之处是，它抽象了一些已有的类的功能。然而，Mediator的目的是对同事之间的任意通讯进行抽象，通常集中不属于单个对象的功能；Facade模式仅仅是对子系统对象的接口进行抽象，从而使它们更容易使用。

# 对象池 —— Flyweight
运用共享技术有效地支持大量细粒度对象，**适用于那些因为数量太大而难以用对象来表示的概念或实体进行建模**

## 适用性
Flyweight 模式的有效性很大程度上取决于如何使用它以及在何处使用它:
1. 一个应用程序使用了大量的对象
2. 完全由于使用大量对象，造成很大的存储开销
3. 对象的大多数状态都可变为外部状态
4. 如果删除对象中的外部状态，那么可以用相对较少的共享对象取代很多组对象
5. 应用程序不依赖于对象标识，由于Flyweight对象可以被共享，对于概念上明显有别的对象，标识测试将返回真值

## 结构
{%raw%}
<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" id="processonSvg1000" viewBox="66.47058823529416 287.9411764705881 963.0000000000003 381.00000000000006" width="100%" height="100%"><defs id="ProcessOnDefs1001"><marker id="ProcessOnMarker1023" markerUnits="userSpaceOnUse" orient="auto" markerWidth="20.609529741924973" markerHeight="10.888175666885001" viewBox="-2.3047648709624866 -1.5914908829822711 20.609529741924973 10.888175666885001" refX="16.0" refY="3.8525969504602293"><path id="ProcessOnPath1024" d="M0 3.8525969504602293L8.0 0L16.0 3.8525969504602293L8.0 7.705193900920459Z" stroke="#323232" stroke-width="2.0" fill="#fff"/></marker><marker id="ProcessOnMarker1025" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1026" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1049" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1050" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#fff" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1053" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1054" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#fff" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1061" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1062" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1065" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1066" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1069" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606797749979" markerHeight="10.550836550532098" viewBox="-1.0 -1.3763819204711736 16.23606797749979 10.550836550532098" refX="-1.0" refY="3.8990363547948754"><path id="ProcessOnPath1070" d="M12.0 3.8990363547948754L0.0 7.798072709589751V0.0Z" stroke="#323232" stroke-width="2.0" fill="#323232" transform="matrix(1.0,0.0,0.0,1.0,0.0,0.0)"/></marker><marker id="ProcessOnMarker1085" markerUnits="userSpaceOnUse" orient="auto" markerWidth="10.0" markerHeight="10.0" viewBox="-1.0 -1.0 10.0 10.0" refX="0.0" refY="4.0"><path id="ProcessOnPath1086" d="M0 4.0A4.0 4.0 0 0 1 4.0 0A4.0 4.0 0 1 1 0 4.0" stroke="#323232" stroke-width="2.0" fill="#fff"/></marker></defs><g id="ProcessOnG1002"><path id="ProcessOnPath1003" d="M66.47058823529416 287.9411764705881H1029.4705882352946V668.9411764705882H66.47058823529426V287.9411764705881Z" fill="none"/><g id="ProcessOnG1004"><g id="ProcessOnG1005" transform="matrix(1.0,0.0,0.0,1.0,628.4705882352945,307.9411764705881)" opacity="1.0"><path id="ProcessOnPath1006" d="M0.0 4.0Q0.0 0.0 4.0 0.0L213.0 0.0Q217.0 0.0 217.0 4.0L217.0 64.0Q217.0 68.0 213.0 68.0L4.0 68.0Q0.0 68.0 0.0 64.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1007" d="M0.0 30.0L217.0 30.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1008" d="M0.0 0.0L217.0 0.0L217.0 68.0L0.0 68.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1009" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1010" fill="#323232" font-size="15" x="97.5" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">Flyweight</text></g><g id="ProcessOnG1011" transform="matrix(1.0,0.0,0.0,1.0,10.0,39.625)"><text id="ProcessOnText1012" fill="#323232" font-size="15" x="97.5" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">operation(extrinsicState)</text></g></g><g id="ProcessOnG1013" transform="matrix(1.0,0.0,0.0,1.0,283.4705882352941,307.9411764705881)" opacity="1.0"><path id="ProcessOnPath1014" d="M0.0 4.0Q0.0 0.0 4.0 0.0L217.0 0.0Q221.0 0.0 221.0 4.0L221.0 64.0Q221.0 68.0 217.0 68.0L4.0 68.0Q0.0 68.0 0.0 64.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1015" d="M0.0 30.0L221.0 30.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1016" d="M0.0 0.0L221.0 0.0L221.0 68.0L0.0 68.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1017" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1018" fill="#323232" font-size="15" x="99.5" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">FlyweightFactory</text></g><g id="ProcessOnG1019" transform="matrix(1.0,0.0,0.0,1.0,10.0,39.625)"><text id="ProcessOnText1020" fill="#323232" font-size="15" x="99.5" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">getFlyweight(key)</text></g></g><g id="ProcessOnG1021"><path id="ProcessOnPath1022" d="M522.7753531062566 341.9411764705881L566.4705882352945 341.9411764705881L566.4705882352945 341.9411764705881L613.2345202577947 341.9411764705881" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-start="url(#ProcessOnMarker1023)" marker-end="url(#ProcessOnMarker1025)"/></g><g id="ProcessOnG1027" transform="matrix(1.0,0.0,0.0,1.0,445.47058823529403,473.9411764705881)" opacity="1.0"><path id="ProcessOnPath1028" d="M0.0 4.0Q0.0 0.0 4.0 0.0L232.0 0.0Q236.0 0.0 236.0 4.0L236.0 95.0Q236.0 99.0 232.0 99.0L4.0 99.0Q0.0 99.0 0.0 95.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1029" d="M0.0 30.0L236.0 30.0M0.0 60.0L236.0 60.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1030" d="M0.0 0.0L236.0 0.0L236.0 99.0L0.0 99.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1031" transform="matrix(1.0,0.0,0.0,1.0,10.0,5.625)"><text id="ProcessOnText1032" fill="#323232" font-size="15" x="107.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">ConcreteFlyweight</text></g><g id="ProcessOnG1033" transform="matrix(1.0,0.0,0.0,1.0,10.0,35.625)"><text id="ProcessOnText1034" fill="#323232" font-size="15" x="107.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">operation(extrinsicState)</text></g><g id="ProcessOnG1035" transform="matrix(1.0,0.0,0.0,1.0,10.0,65.625)"><text id="ProcessOnText1036" fill="#323232" font-size="15" x="107.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">intrinsicState</text></g></g><g id="ProcessOnG1037" transform="matrix(1.0,0.0,0.0,1.0,758.9705882352945,473.9411764705881)" opacity="1.0"><path id="ProcessOnPath1038" d="M0.0 4.0Q0.0 0.0 4.0 0.0L246.5 0.0Q250.5 0.0 250.5 4.0L250.5 95.0Q250.5 99.0 246.5 99.0L4.0 99.0Q0.0 99.0 0.0 95.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1039" d="M0.0 38.0L250.5 38.0M0.0 68.0L250.5 68.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><path id="ProcessOnPath1040" d="M0.0 0.0L250.5 0.0L250.5 99.0L0.0 99.0Z" stroke="none" stroke-width="0.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1041" transform="matrix(1.0,0.0,0.0,1.0,10.0,9.625)"><text id="ProcessOnText1042" fill="#323232" font-size="15" x="114.25" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">UnsharedConcreteFlyweight</text></g><g id="ProcessOnG1043" transform="matrix(1.0,0.0,0.0,1.0,10.0,43.625)"><text id="ProcessOnText1044" fill="#323232" font-size="15" x="114.25" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">operation(extrinsicState)</text></g><g id="ProcessOnG1045" transform="matrix(1.0,0.0,0.0,1.0,10.0,73.625)"><text id="ProcessOnText1046" fill="#323232" font-size="15" x="114.25" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">allState</text></g></g><g id="ProcessOnG1047"><path id="ProcessOnPath1048" d="M563.4705882352944 473.9411764705881L563.4705882352944 424.9411764705881L736.9705882352945 424.9411764705881L736.9705882352945 391.1772444480879" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1049)"/></g><g id="ProcessOnG1051"><path id="ProcessOnPath1052" d="M884.2205882352945 473.9411764705881L884.2205882352945 424.9411764705881L736.9705882352945 424.9411764705881L736.9705882352945 391.1772444480879" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1053)"/></g><g id="ProcessOnG1055" transform="matrix(1.0,0.0,0.0,1.0,287.4705882352941,578.9411764705882)" opacity="1.0"><path id="ProcessOnPath1056" d="M0.0 4.0Q0.0 0.0 4.0 0.0L96.0 0.0Q100.0 0.0 100.0 4.0L100.0 66.0Q100.0 70.0 96.0 70.0L4.0 70.0Q0.0 70.0 0.0 66.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><g id="ProcessOnG1057" transform="matrix(1.0,0.0,0.0,1.0,10.0,25.625)"><text id="ProcessOnText1058" fill="#323232" font-size="15" x="39.0" y="15.375" font-family="微软雅黑" font-weight="bold" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="middle" size="15">Client</text></g></g><g id="ProcessOnG1059"><path id="ProcessOnPath1060" d="M337.47058823529403 578.9411764705882L337.47058823529403 477.4411764705881L337.47058823529403 477.4411764705881L337.47058823529403 391.1772444480879" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1061)"/></g><g id="ProcessOnG1063"><path id="ProcessOnPath1064" d="M387.47058823529403 613.9411764705882L416.47058823529403 613.9411764705882L416.47058823529403 493.9411764705881L430.23452025779426 493.9411764705881" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1065)"/></g><g id="ProcessOnG1067"><path id="ProcessOnPath1068" d="M387.47058823529403 613.9411764705882L719.4705882352945 613.9411764705882L719.4705882352945 496.9411764705881L744.2345202577947 496.9411764705881" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none" marker-end="url(#ProcessOnMarker1069)"/></g><g id="ProcessOnG1071" transform="matrix(1.0,0.0,0.0,1.0,86.47058823529416,402.9411764705881)" opacity="1.0"><path id="ProcessOnPath1072" d="M0.0 0.0L205.0 0.0L221.0 16.0L221.0 148.0L0.0 148.0L0.0 0.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1073" d="M205.0 0.0L205.0 16.0L221.0 16.0" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="#f5927b"/><path id="ProcessOnPath1074" d="M0.0 0.0L205.0 0.0L221.0 16.0L221.0 148.0L0.0 148.0L0.0 0.0Z" stroke="#323232" stroke-width="2.0" stroke-dasharray="none" fill="none"/><g id="ProcessOnG1075" transform="matrix(1.0,0.0,0.0,1.0,10.0,12.75)"><text id="ProcessOnText1076" fill="#323232" font-size="14" x="0.0" y="14.350000000000001" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="14">if (flyweight[key] exists {</text><text id="ProcessOnText1077" fill="#323232" font-size="14" x="0.0" y="31.85" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="14">    return existing flyweight;</text><text id="ProcessOnText1078" fill="#323232" font-size="14" x="0.0" y="49.35" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="14">} else {</text><text id="ProcessOnText1079" fill="#323232" font-size="14" x="0.0" y="66.85" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="14">    create new flyweight;</text><text id="ProcessOnText1080" fill="#323232" font-size="14" x="0.0" y="84.35" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="14">    add it to pool of flyweight;</text><text id="ProcessOnText1081" fill="#323232" font-size="14" x="0.0" y="101.85" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="14">    return the new flyweight;</text><text id="ProcessOnText1082" fill="#323232" font-size="14" x="0.0" y="119.35" font-family="微软雅黑" font-weight="normal" font-style="normal" text-decoration="none" family="微软雅黑" text-anchor="start" size="14">}</text></g></g><g id="ProcessOnG1083"><path id="ProcessOnPath1084" d="M176.47058823529406 402.9411764705881L177.47058823529406 402.9411764705881L177.47058823529406 358.9411764705881L275.4705882352941 358.9411764705881" stroke="#323232" stroke-width="2.0" stroke-dasharray="10.0 4.0" fill="none" marker-end="url(#ProcessOnMarker1085)"/></g></g></g></svg>
{%endraw%}
下面的对象图说明了如何共享flyweight
![flyweight](/images/flyweight.png)

## 参与者
- `Flyweight`: 描述一个接口，通过这个接口Flyweight可以接受作用于外部状态
- `ConcreteFlyweight`: 实现Flyweight接口，并为内部状态增加存储空间。 `ConcreteFlyweight`对象必须是可共享的，它存储的状态必须是内部的，必须独立于`ConcreteFlyweight`对象的场景
- `UnsharedConcreteFlyweight`: 并非所有的Flyweight子类都需要被共享，Flyweight对象结构的某些层次，`UnsharedConcreteFlyweight`对象通常将`ConcreteFlyweight`对象作为子节点
- `FlyweightFactory`: 创建并管理Flyweight对象；确保合理地共享flyweight
- `Client`: 维持一个对flyweight的引用；计算或存储一个或多个flyweight的外部状态

## 协作
- **Flyweight执行时需要两种状态——内部的和外部的** 内部状态存储于ConcreteFlyweight对象之中；外部状态则由Client对象存储或计算。
- **用户只能从FlyweightFactory对象中得到ConcreteFlyweight对象** 这样才能保证这些对象被适当地共享

共享的Flyweight越多，存储节约也就越多。

## 实现
在使用Flyweight模式时，应该注意以下几点：
1. **删除外部状态**。该模式的可用性在很大程度上取决于是否容易识别外部状态并将它从共享对象中删除。如果不同种类的外部状态和共享前对象的数目相同的话，删除外部状态不会降低存储消耗。理想的状况是，外部状态可以由一个单独的对象结构中计算得到，且该结构的存储要求非常小
2. **管理共享对象**。因为对象是共享的，所以用户不能直接对它实例化。用户需要通过FlyweightFactory来操纵共享对象。而且若Flyweight对象数量多的话，还会涉及到引用计数和垃圾回收。

## 相关模式
Flyweight模式通常和Composite模式结合起来，用共享叶结点的有向无环图实现一个逻辑上的层次结构。
通常，最好使用Flyweight来实现State和Strategy对象。

# Proxy
为其他对象提供一种代理以控制对这个对象的访问。
对一个对象进行访问控制的一个原因是为了在我们确实需要这个对象时，才对它进行创建和初始化。这种策略对于那种创建开销很大而且并不一定能用到的对象很适合。使用Proxy代替真正的对象，并且在需要的时候实例化这个图像的对象。

## 适用性
在需要用比较通用和复杂的对象指针代替简单的指针的时候，使用Proxy模式：
1. **远程代理**为一个对象在不同的地址空间提供局部代表
2. **虚代理**根据需要创建开销很大的对象
3. **保护代理**控制对原始对象的访问，适用于对象应该有不同的访问权限的时候
4. **智能指引**取代了简单的指针，在访问对象时会执行一些附加操作，比如：
    - 对指向实际对象的引用计数，当该对象没有引用时，可以自动释放它
    - 第一次引用一个持久对象时，将它装入内存
    - 在访问一个对象前，检查是否已经锁定了它，以确保其他对象不能改变它

## 结构
{%raw%}
<svg xmlns="http://www.w3.org/2000/svg" viewBox="123 71 625 253"><defs><marker id="a" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606798" markerHeight="10.55083655" viewBox="-1 -1.37638192 16.23606798 10.55083655" refX="-1" refY="3.89903635"><path d="M12 3.89903635L0 7.79807271V0z" stroke="#323232" stroke-width="2" fill="#fff"/></marker><marker id="b" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606798" markerHeight="10.55083655" viewBox="-1 -1.37638192 16.23606798 10.55083655" refX="-1" refY="3.89903635"><path d="M12 3.89903635L0 7.79807271V0z" stroke="#323232" stroke-width="2" fill="#323232"/></marker><marker id="c" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606798" markerHeight="10.55083655" viewBox="-1 -1.37638192 16.23606798 10.55083655" refX="-1" refY="3.89903635"><path d="M12 3.89903635L0 7.79807271V0z" stroke="#323232" stroke-width="2" fill="#fff"/></marker><marker id="d" markerUnits="userSpaceOnUse" orient="auto" markerWidth="10" markerHeight="10" viewBox="-1 -1 10 10" refX="8" refY="4"><path d="M0 4a4 4 0 0 1 4-4 4 4 0 1 1-4 4" stroke="#323232" stroke-width="2" fill="#fff"/></marker><marker id="e" markerUnits="userSpaceOnUse" orient="auto" markerWidth="16.23606798" markerHeight="10.55083655" viewBox="-1 -1.37638192 16.23606798 10.55083655" refX="-1" refY="3.89903635"><path d="M12 3.89903635L0 7.79807271V0z" stroke="#323232" stroke-width="2" fill="#323232"/></marker></defs><path d="M123 71h625v253H123V71z" fill="none"/><path d="M378 95q0-4 4-4h109q4 0 4 4v53q0 4-4 4H382q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M378 121h117" stroke="#323232" stroke-width="2" fill="none"/><path d="M378 91h117v61H378z" fill="none"/><text fill="#323232" font-size="15" x="47.5" y="15.375" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(388 96.625)">Subject</text><text fill="#323232" font-size="15" x="47.5" y="15.375" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(388 127.125)">request()</text><path d="M378 241.5q0-4 4-4h109q4 0 4 4v53q0 4-4 4H382q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M378 267.5h117" stroke="#323232" stroke-width="2" fill="none"/><path d="M378 237.5h117v61H378z" fill="none"/><text fill="#323232" font-size="15" x="47.5" y="15.375" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(388 243.125)">Proxy</text><text fill="#323232" font-size="15" x="47.5" y="15.375" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(388 273.625)">request()</text><path d="M436.5 237.5v-70.26393202" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#a)"/><path d="M143 241.5q0-4 4-4h109q4 0 4 4v53q0 4-4 4H147q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M143 267.5h117" stroke="#323232" stroke-width="2" fill="none"/><path d="M143 237.5h117v61H143z" fill="none"/><text fill="#323232" font-size="15" x="47.5" y="15.375" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(153 243.125)">RealSubject</text><text fill="#323232" font-size="15" x="47.5" y="15.375" font-family="微软雅黑" text-anchor="middle" transform="translate(153 273.625)">request()</text><path d="M378 252H275.23606798" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#b)"/><path d="M201.5 237.5v-42.75h235v-27.51393202" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#c)"/><path d="M551 264h161l16 16v24H551v-40z" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M712 264v16h16" stroke="#323232" stroke-width="2" fill="#f5927b"/><path d="M551 264h161l16 16v24H551v-40z" stroke="#323232" stroke-width="2" fill="none"/><text fill="#323232" font-size="15" x="77.5" y="15.375" font-family="微软雅黑" text-anchor="middle" transform="translate(561 274.625)">realSubject.request()</text><path d="M252 217h160v40H252z" fill="none"/><text fill="#323232" font-size="15" x="79" y="15.375" font-family="微软雅黑" text-anchor="middle" transform="translate(252 227.625)">realSubject</text><path d="M484 285h66" stroke="#323232" stroke-width="2" stroke-dasharray="10.0 4.0" fill="none" marker-start="url(#d)"/><path d="M156 104.75q0-4 4-4h83q4 0 4 4v33.5q0 4-4 4h-83q-4 0-4-4z" stroke="#323232" stroke-width="2" fill="#f5927b"/><text fill="#323232" font-size="15" x="34.5" y="15.375" font-family="微软雅黑" font-weight="bold" text-anchor="middle" transform="translate(166 112.125)">Client</text><path d="M247 121.5h115.76393202" stroke="#323232" stroke-width="2" fill="none" marker-end="url(#e)"/></svg>
{%endraw%}

## 参与者
- Proxy: 保存一个引用使得代理可以访问实体。若RealSubject和Subject的接口相同，Proxy会应用Subject；提供一个与Subject的接口相同的接口，这样代理就可以用来代替实体
- Subject: 定义RealSubject和Proxy的共用接口，这样就在任何使用RealSubject的地方都可以使用Proxy
- RealSubject: 定义Proxy所代表的实体

## 效果
Proxy模式在访问对象时引入了一定程度的间接性。根据代理的类型，附加的间接性有很多种用途：
- Remote Proxy 可以隐藏一个对象存在于不同地址空间的事实
- Virtual Proxy 可以进行最优化，例如根据要求创建对象
- Protection Proxy 允许在访问一个对象时有些附加的任务处理

Proxy模式还可以实现copy-on-write方式的优化。在实现copy-on-write时必须对实体进行引用计数，拷贝代理仅增加引用计数，只有当用户请求修改该实体的操作时，代理才会真正拷贝该对象。

## 代码示例
定义一个`Graphic`接口：
```java
public interface Graphic {
    void draw();
    void handleMouse();
    void load();
    void save();
    String getExtent();
}
```

`Image` 是实现了 `Graphic` 接口的类
```java
public class Image implements Graphic {
    @Override
    public void draw() {
    }
    @Override
    public void handleMouse() {
    }
    @Override
    public void load() {
    }
    @Override
    public void save() {
    }
    @Override
    public String getExtent() {
        return null;
    }
}
```

`ImageProxy` 是对 `Image` 类的代理类：
```java
/**
 * ImageProxy 同 Image 有相同的接口
 */
public class ImageProxy implements Graphic{
    /** proxy 中需要保存对 Image 的引用 */
    private Image image;
    private String fileName;
    private String extend;
    private String imageAttr;
    public ImageProxy(String fileName) {
        this.fileName = fileName;
    }
    /** 延时实例化 image 对象 */
    protected Image getImage() {
        if (image == null) {
            image = new Image();
        }
        return image;
    }
    /** 在代理中保存Image的某个属性 */
    @Override
    public String getExtent() {
        if (extend == null) {
            extend = getImage().getExtent();
        }
        return extend;
    }

    @Override
    public void draw() {
        getImage().draw();
    }

    @Override
    public void handleMouse() {
        getImage().handleMouse();
    }

    @Override
    public void load() {
    }

    @Override
    public void save() {
    }
}
```

## 相关模式
1. Adapter: 适配器模式为它所适配的对象听了一个不同的接口，而代理提供了与它实体相同的接口。用于访问保护的代理可能会拒绝执行实体会执行的操作，因此它的接口实际上可能只是实体接口的一个子集
2. Decorator: 装饰者模式为对象添加一个或多个功能，而代理控制对象的访问

# 结构型模式总结
结构型模式之间具有相似性，尤其是它们的参与者和协作者之间。

## Adapter 与 Bridge
这两个模式都是给另一个对象提供了一定程度上的间接性，有利于系统的灵活性，都是从自身以外的一个接口向这个对象转发请求。
但是这两种模式的用途不同：
- Adapter模式主要是为了解决两个已有接口之间不匹配的问题，不考虑这些接口是怎么实现的，也不考虑它们各自可能会如何演化
- Bridge模式对抽象接口与它的实现部分进行桥接，虽然它允许你修改实现它的类，它仍然为用户提供一个稳定的接口，Bridge也会在系统演化时适应新的实现

由于两种模式的不同点，**Adapter模式在类设计好后实施，Bridge在设计类之前实施**

## Composite、Decorator与Proxy
Composite模式同Decorator模式具有类似的结构图，这说明它们都 **基于递归组合来组织可变数目的对象**
Decorator旨在使你能够不需要生成子类即可给对象添加职责，避免了静态实现所有功能组合，从而导致子类数量急剧增加。Composite则旨在构造类，使多个相关的独享能够以统一的方式处理，而多重对象可以被当作一个对象来处理，其重点不在于修饰，而在于表示。
